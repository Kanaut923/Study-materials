这是一份基于你提供的全套《数字信号处理》课件（第1、2、3、4、5、6章）整理而成的系统性课程讲义规划。

为了达到“完全掌握”的目标，我将课程重新划分为**5大模块，共计12次核心精讲**。这个划分基于知识点的逻辑深度和关联性，而非简单的按章节平铺。

---

### **课程全景逻辑梳理**

在开始分章节讲义前，首先建立宏观框架：
1.  **基础理论（第1章）**：是所有后续内容的数学基石（时域、频域、Z域）。
2.  **接口理论（第2章）**：解决模拟世界进入数字世界的问题（采样与重建）。
3.  **核心算法（第3章）**：解决计算机如何处理无限长、连续频谱信号的问题（DFT与FFT）。
4.  **系统设计（第4、5章）**：如何设计系统$H(z)$来处理信号（IIR与FIR滤波器设计）。
5.  **工程实现（第6章）**：设计好的系统如何在硬件/软件中搭建结构并处理误差。

---

### **详细课程讲义与目录划分**

#### **模块一：信号与系统的时频域基础（对应第1章）**
**目标**：掌握离散信号的数学表达、Z变换与频域分析工具。本章内容极其重要，建议分**3次**讲解。

*   **第1讲：离散时间信号与系统的时域分析**
    *   **核心内容**：
        *   典型序列：$\delta(n)$（单位脉冲）、$u(n)$（阶跃）、$R_N(n)$（矩形）、实/复指数序列。
        *   系统性质：线性、时不变性（LTI）、因果性、稳定性的判据。
        *   卷积和：线性卷积的定义与计算（$y(n) = x(n) * h(n)$）。
        *   差分方程：描述LTI系统的方程及其递推解法。
    *   *重点难点*：判定系统性质（如$y(n)=x(n^2)$是时变的）；卷积的翻转平移计算。

*   **第2讲：Z变换及其逆变换**
    *   **核心内容**：
        *   定义与收敛域（ROC）：双边Z变换，ROC的形状（圆环、圆内、圆外）与序列性质（因果、稳定）的关系。
        *   常用性质：移位性质（$z^{-m}$）、指数加权（尺度变换）、卷积定理（时域卷积=Z域相乘）。
        *   逆Z变换：部分分式展开法（长除法和留数法作为辅助）。
    *   *重点难点*：收敛域ROC的判定，不同ROC对应不同的时域序列。

*   **第3讲：系统的频域分析与系统函数**
    *   **核心内容**：
        *   DTFT（离散时间傅里叶变换）：定义、$X(e^{j\omega})$的周期性（$2\pi$）、对称性。
        *   DTFT与Z变换的关系：$z=e^{j\omega}$（单位圆上的Z变换）。
        *   系统函数$H(z)$：零极点分布与频率响应$H(e^{j\omega})$的几何法分析。
        *   Parseval定理：时域能量等于频域能量。

---

#### **模块二：模拟与数字的桥梁（对应第2章）**
**目标**：理解信号数字化的理论极限。建议**1次**讲解。

*   **第4讲：信号的采样与重建**
    *   **核心内容**：
        *   A/D转换模型：采样 $\to$ 量化 $\to$ 编码。
        *   **采样定理**：时域离散 $\leftrightarrow$ 频域周期延拓。奈奎斯特频率（$f_s \geq 2f_{max}$）防止混叠。
        *   插值与重建：理想低通滤波器（内插函数Sinc）从样本恢复连续信号。
        *   折叠频率：$\Omega_s/2$，高于此频率的成分会发生混叠。
    *   *重点难点*：理解频域的“周期延拓”造成混叠的本质；实际工程中抗混叠滤波器的必要性。

---

#### **模块三：离散傅里叶变换及其快速算法（对应第3章）**
**目标**：解决计算机计算频谱的问题，是DSP的核心算法。建议**3次**讲解。

*   **第5讲：DFS与DFT的定义及性质**
    *   **核心内容**：
        *   DFS（离散傅里叶级数）：周期序列的频域表示（也是周期的）。
        *   DFT（离散傅里叶变换）：有限长序列的频域表示（隐含周期性，主值区间）。
        *   **重要性质**：
            *   圆周移位（循环移位）：$x((n+m))_N \leftrightarrow W_N^{-mk}X(k)$。
            *   **圆周卷积**：时域圆周卷积对应频域相乘。
    *   *重点难点*：区分线性卷积与圆周卷积；什么时候圆周卷积等于线性卷积（补零，$L \geq N+M-1$）。

*   **第6讲：FFT算法原理（基2-FFT）**
    *   **核心内容**：
        *   直接计算DFT的复杂度：$O(N^2)$。
        *   FFT的基本思想：利用$W_N^{nk}$的周期性、对称性、可约性。
        *   **DIT-FFT（按时间抽取）**：蝶形运算流图，倒位序输入，自然序输出。
        *   **DIF-FFT（按频率抽取）**：自然序输入，倒位序输出。
        *   运算量：$N\log_2N$，复数乘法和加法的节省。
    *   *重点难点*：蝶形运算图的画法；码位倒置（Bit-reversal）的概念。

*   **第7讲：DFT/FFT的应用**
    *   **核心内容**：
        *   利用DFT分析连续信号频谱：参数选择（采样率、截断长度）、栅栏效应、频谱泄漏（加窗）。
        *   快速卷积：利用FFT计算线性卷积（重叠相加法、重叠保留法）。
    *   *重点难点*：理解频谱泄漏的原因（截断=加矩形窗=频域卷积Sinc函数）；如何选择参数以提高分辨率。

---

#### **模块四：数字滤波器设计（对应第4、5章）**
**目标**：学会设计IIR和FIR滤波器。这是DSP的应用核心。建议**3次**讲解。

*   **第8讲：IIR滤波器设计（基于模拟原型）**
    *   **核心内容**：
        *   设计思路：模拟滤波器（Butterworth, Chebyshev） $\to$ 数字化。
        *   **脉冲响应不变法**：$h(n) = h_a(nT)$。优点是频率线性；缺点是**频谱混叠**，只适合低通、带通。
        *   **双线性变换法**：$s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$。优点无混叠；缺点是**频率畸变**（非线性映射），需要预畸变校正。
    *   *重点难点*：两种变换方法的优缺点对比；预畸变频率的计算。

*   **第9讲：FIR滤波器特性与窗函数设计法**
    *   **核心内容**：
        *   **线性相位条件**：$h(n)$偶对称或奇对称。四种类型的幅频特性。
        *   窗函数设计法（时域逼近）：理想低通$h_d(n)$ $\times$ 窗函数$w(n)$。
        *   常用窗函数：矩形窗、汉宁窗、汉明窗、布莱克曼窗、凯塞窗。
        *   吉布斯效应（Gibbs）：截断导致的肩峰和余振。
    *   *重点难点*：窗函数的主瓣宽度（影响过渡带）与旁瓣衰减（影响阻带衰减）的矛盾关系。

*   **第10讲：IIR与FIR的比较与选择**
    *   **核心内容**：
        *   IIR：有反馈（递归），极点可不在原点，阶数低，非线性相位，主要用于幅频特性要求高但相位要求不高的场合。
        *   FIR：无反馈（非递归），极点在原点（稳定），阶数高，严格线性相位，用于对相位失真敏感的场合。

---

#### **模块五：系统的实现与误差分析（对应第6章）**
**目标**：从数学公式落地到硬件/软件结构。建议**2次**讲解。

*   **第11讲：数字滤波器的结构**
    *   **核心内容**：
        *   信号流图：加法器、乘法器、延时单元。
        *   IIR结构：直接I型、直接II型（典范型，省延时单元）、级联型（降低系数量化敏感度）、并联型（运算速度快）。
        *   FIR结构：横截型（卷积型）、级联型、线性相位结构（利用对称性减少乘法一半）。
    *   *重点难点*：根据差分方程画出直接II型结构图；线性相位FIR结构的简化。

*   **第12讲：有限字长效应（量化误差）**
    *   **核心内容**：
        *   数的表示：定点制与浮点制，原码/补码，截尾与舍入。
        *   误差来源：
            1.  A/D转换量化噪声。
            2.  系数及化误差（影响极点位置，IIR可能失稳）。
            3.  运算过程（乘法）的舍入噪声。
        *   **极限环振荡**（IIR特有）：由于非线性量化导致的寄生振荡（零输入极限环）。
    *   *重点难点*：理解为什么IIR会有极限环而FIR没有（FIR无反馈环路）。

---

### **课程核心知识点（复习速查表）**

| 章节 | 核心概念 | 关键公式/结论 | 易错点/提示 |
| :--- | :--- | :--- | :--- |
| **Ch1** | **LTI系统** | $y(n) = \sum x(k)h(n-k)$ | 卷积翻转的是$k$轴；$z$变换注意ROC。 |
| **Ch2** | **采样定理** | $f_s \ge 2f_{max}$ | 混叠是因为频谱以$f_s$为周期延拓重叠。 |
| **Ch3** | **DFT/FFT** | $X(k) = \sum_{n=0}^{N-1} x(n)W_N^{nk}$ | 圆周卷积长度$L \ge N+M-1$时等于线性卷积。 |
| **Ch4** | **IIR设计** | 双线性变换：$s \to \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$ | 脉冲响应不变法有混叠；双线性变换有频率畸变。 |
| **Ch5** | **FIR设计** | 线性相位条件：$h(n)=\pm h(N-1-n)$ | 窗函数主瓣越宽，过渡带越宽；旁瓣越小，阻带衰减越大。 |
| **Ch6** | **结构实现** | 直接II型（最省）、级联型（误差小） | IIR对系数量化敏感，可能不稳定；FIR永远稳定。 |

这份讲义规划涵盖了课件的所有核心内容，按照此路径学习，可以系统性地掌握数字信号处理的理论与应用。建议在复习时，对着具体的PPT页码（如“例题”部分）进行手算练习，特别是FFT蝶形图和滤波器设计的计算。

---
好的，按照我们制定的《数字信号处理》课程大纲，以下是**第一讲：离散时间信号与系统的时域分析**的详细讲义。

这一讲是整个DSP（数字信号处理）大厦的地基，重点在于理解“离散”的特性以及LTI（线性时不变）系统的核心地位。

---

# **第1讲：离散时间信号与系统的时域分析**

## **一、 学习目标**
1.  **掌握**典型离散序列的定义、波形及相互关系（尤其是$\delta(n)$和$u(n)$）。
2.  **深刻理解**系统的四大性质：线性、时不变性、因果性、稳定性。
3.  **熟练掌握**卷积和（Convolution Sum）的定义、物理意义及计算方法（图解法与公式法）。
4.  **了解**常系数差分方程对离散系统的描述方式。

---

## **二、 核心内容精讲**

### **1. 离散时间信号（序列）**
在DSP中，信号不再是连续的$t$的函数，而是整数$n$的函数，记为$x(n)$。
*   **注意**：$x(n)$仅在整数时刻有定义，非整数时刻无定义（不是为0，而是不存在）。

#### **1.1 几种基本的典型序列**
这是后续分析更复杂信号的“积木”。

1.  **单位脉冲序列 $\delta(n)$** (Unit Impulse Sequence)
    $$
    \delta(n) = \begin{cases} 1, & n=0 \\ 0, & n \neq 0 \end{cases}
    $$
    *   **核心性质——筛选性质（Sifting Property）**：
        任何序列$x(n)$与$\delta(n-m)$相乘，结果只保留$m$时刻的值。
        $$ \sum_{n=-\infty}^{\infty} x(n)\delta(n-m) = x(m) $$
        *这是卷积公式推导的数学基础。*

2.  **单位阶跃序列 $u(n)$** (Unit Step Sequence)
    $$
    u(n) = \begin{cases} 1, & n \ge 0 \\ 0, & n < 0 \end{cases}
    $$
    *   **与$\delta(n)$的关系（必考点）**：
        *   差分关系：$\delta(n) = u(n) - u(n-1)$
        *   累加关系：$u(n) = \sum_{k=-\infty}^{n} \delta(k)$

3.  **矩形序列 $R_N(n)$** (Rectangle Sequence)
    $$
    R_N(n) = \begin{cases} 1, & 0 \le n \le N-1 \\ 0, & \text{其他} \end{cases}
    $$
    *   可以用阶跃信号表示：$R_N(n) = u(n) - u(n-N)$。

4.  **实指数序列 $x(n) = a^n u(n)$**
    *   当 $|a| < 1$ 时，序列收敛（稳定）。
    *   当 $|a| > 1$ 时，序列发散（不稳定）。
    *   当 $a$ 为负数时，序列符号交替摆动。

5.  **正弦序列 $x(n) = \sin(\omega_0 n)$**
    *   **重难点——周期性判断**：
        连续信号 $\sin(\Omega t)$ 永远是周期的。
        **但是**，离散信号 $\sin(\omega_0 n)$ **不一定是周期序列**！
    *   **判据**：只有当数字频率 $\omega_0$ 满足以下条件时，才是周期的：
        $$ \frac{2\pi}{\omega_0} = \frac{N}{k} \quad (\text{有理数}) $$
        即 $\omega_0$ 必须是 $2\pi$ 的有理数倍。最小周期 $N$ 是使得 $k$ 为整数的最小整数。
    *   *例题*：$\cos(3n)$ 是周期序列吗？
        *   答：$\frac{2\pi}{3}$ 是无理数，故**不是**周期序列（虽然包络是周期的，但采样点不会重复落在同一个值上）。

---

### **2. 离散时间系统及其性质**
系统是将输入 $x(n)$ 变换为输出 $y(n)$ 的算子，记为 $y(n) = T[x(n)]$。

#### **2.1 线性 (Linearity)**
满足**叠加原理**（叠加性+齐次性）。
$$ T[a x_1(n) + b x_2(n)] = a y_1(n) + b y_2(n) $$
*   **判断技巧**：如果方程中出现 $x^2(n)$、$x(n) \cdot x(n-1)$、$|x(n)|$ 或常数项（如 $2x(n)+1$），则为**非线性**。

#### **2.2 时不变性 (Time-Invariance)**
系统的参数不随时间 $n$ 变化。即：若输入延迟 $k$，输出也仅延迟 $k$，波形不变。
$$ x(n) \to y(n) \implies x(n-k) \to y(n-k) $$
*   **判断技巧**：观察系数。如果系数中显式包含了 $n$（例如 $y(n) = n \cdot x(n)$ 或 $y(n) = x(2n)$），则通常是**时变**系统。
    *   *特例*：$y(n) = x(n) \cos(\omega_0 n)$ 是时变系统（因为 $\cos$ 值随 $n$ 变）。

#### **2.3 线性时不变系统 (LTI)**
这是DSP研究的核心对象。
*   **核心结论**：LTI系统的特性完全由其**单位脉冲响应 $h(n)$** 决定。
*   输入输出关系为**卷积和**：
    $$ y(n) = x(n) * h(n) $$

#### **2.4 因果性 (Causality)**
输出仅取决于当前和过去的输入（不依赖未来的输入）。
*   **物理意义**：现实可实现的实时系统必须是因果的。
*   **判据**：
    *   时域判据：$h(n) = 0, \quad \text{当 } n < 0$。

#### **2.5 稳定性 (Stability)**
输入有界（Bounded Input），输出必有界（Bounded Output），简称 **BIBO 稳定**。
*   **判据（必考）**：单位脉冲响应**绝对可和**。
    $$ \sum_{n=-\infty}^{\infty} |h(n)| < \infty $$

---

### **3. 卷积和 (Convolution Sum)**

这是本章计算的重头戏。

#### **3.1 定义公式**
$$ y(n) = x(n) * h(n) = \sum_{k=-\infty}^{\infty} x(k) h(n-k) $$

#### **3.2 计算步骤（“翻转-平移-相乘-求和”四部曲）**
假设我们要计算在时刻 $n$ 的输出 $y(n)$：
1.  **换元**：将 $x(n), h(n)$ 的自变量换为 $k$，画出 $x(k)$ 和 $h(k)$。
2.  **翻转**：将 $h(k)$ 关于纵轴翻转，得到 $h(-k)$。
3.  **平移**：将 $h(-k)$ 向右平移 $n$ 个单位（若 $n$ 为负则左移），得到 $h(n-k)$。
4.  **相乘求和**：将 $x(k)$ 与平移后的 $h(n-k)$ 对应位相乘，然后累加所有乘积，得到 $y(n)$。

#### **3.3 卷积的重要性质**
1.  **交换律**：$x(n) * h(n) = h(n) * x(n)$
2.  **结合律**：$[x(n) * h_1(n)] * h_2(n) = x(n) * [h_1(n) * h_2(n)]$ （级联系统）
3.  **分配律**：$x(n) * [h_1(n) + h_2(n)] = x(n)*h_1(n) + x(n)*h_2(n)$ （并联系统）
4.  **长度性质**：若 $x(n)$ 长为 $N$，$h(n)$ 长为 $M$，则卷积结果 $y(n)$ 的长度为：
    $$ L = N + M - 1 $$

---

### **4. 常系数线性差分方程**

描述LTI系统的输入输出关系：
$$ \sum_{k=0}^{N} a_k y(n-k) = \sum_{r=0}^{M} b_r x(n-r) $$

*   **求解方法**：
    1.  **迭代法**：适合计算机编程，给初始条件一步步算。
    2.  **时域经典法**：齐次解 + 特解（类似于微分方程，较繁琐，了解即可）。
    3.  **Z变换法**：工程中最常用的方法（**下一讲重点**）。

---

## **三、 典型习题与易错点分析**

### **例题1：系统性质判定**
判断系统 $y(n) = x(n^2)$ 的性质。
*   **线性**：满足。因为没有平方、常数项等非线性操作。
*   **时不变性**：
    *   先移位后变换：$y_d(n) = x(n^2 - n_0)$
    *   先变换后移位：输入变为 $x(n-n_0)$，代入系统得 $y'(n) = x(n^2 - n_0)$
    *   **等等！这里是陷阱！**
    *   正确的**先变换后移位**：令 $g(n) = x(n-n_0)$，则系统输出为 $g(n^2) = x(n^2 - n_0)$。
    *   正确的**先移位后变换**（输出延迟）：$y(n-n_0) = x((n-n_0)^2)$。
    *   显然 $x(n^2 - n_0) \neq x((n-n_0)^2)$。
    *   **结论**：**时变系统**。

### **例题2：卷积计算**
已知 $x(n) = R_3(n)$ (即 {1, 1, 1})， $h(n) = R_2(n)$ (即 {1, 1})。求 $y(n)$。
*   **分析**：
    *   长度：$L = 3 + 2 - 1 = 4$。
    *   $n=0$: $1\times1 = 1$
    *   $n=1$: $1\times1 + 1\times1 = 2$
    *   $n=2$: $1\times1 + 1\times1 = 2$
    *   $n=3$: $1\times1 = 1$
    *   结果：$y(n) = \{1, 2, 2, 1\}$。

---

## **四、 第一讲小结**
1.  **信号**：离散信号不是简单的采样，要注意正弦序列周期性的条件（$2\pi/\omega_0$为有理数）。
2.  **系统**：LTI系统是基石，必须能够熟练判断线性、时不变、因果和稳定。
3.  **运算**：卷积和是时域分析的唯一核心工具，牢记“翻转、平移、相乘、求和”的物理过程，它是理解后续频域乘积特性的基础。

## **五、 课后思考（为下一讲铺垫）**
*   卷积在时域计算很麻烦，特别是当序列很长时。有没有一种方法可以把复杂的“卷积”变成简单的“乘法”？
*   （提示：这就是下一讲**Z变换**和后续**频域分析**的威力所在）。

---
好的，按照我们的课程规划，今天进行**第2讲：Z变换及其逆变换**。

如果说第一讲的“离散信号与卷积”是DSP的时域基石，那么**Z变换**就是通往“复频域”的桥梁。它之于离散系统，地位等同于拉普拉斯变换之于连续系统。掌握Z变换，我们将不再需要在时域里痛苦地计算卷积，而是可以通过代数运算轻松解决差分方程。

---

# **第2讲：Z变换及其逆变换**

## **一、 学习目标**
1.  **掌握**Z变换的定义，能够计算典型序列的Z变换。
2.  **深刻理解**收敛域（ROC, Region of Convergence）的概念及其与时域序列特性（因果、稳定、双边）的对应关系（**核心难点**）。
3.  **熟练运用**Z变换的常用性质（特别是移位、卷积、指数加权）。
4.  **精通**逆Z变换的计算方法，特别是**部分分式展开法**。
5.  **理解**Z变换与DTFT（离散时间傅里叶变换）的联系（单位圆上的Z变换）。

---

## **二、 核心内容精讲**

### **1. Z变换的定义与收敛域 (ROC)**

#### **1.1 定义公式**
对于任意离散序列 $x(n)$，其双边Z变换定义为：
$$ X(z) = \mathcal{Z}\{x(n)\} = \sum_{n=-\infty}^{\infty} x(n) z^{-n} $$
*   **$z$ 的含义**：$z$ 是一个复变量，通常表示为极坐标形式 $z = r e^{j\omega}$。
*   **物理意义**：将时域序列映射到复平面（Z平面）上。

#### **1.2 收敛域 (ROC)**
Z变换不仅仅是一个函数表达式，它必须附带一个**收敛域**才算完整。
*   **定义**：使级数 $\sum |x(n)z^{-n}| < \infty$（绝对收敛）的 $z$ 值集合。
*   **几何形状**：在Z平面上，ROC通常是以原点为圆心的**圆环**、**圆内**或**圆外**区域。

#### **1.3 典型序列的ROC分类（必考重难点）**

| 序列类型 | 时域特征 | ROC 特征 | 极点位置关系 | 典型示例 |
| :--- | :--- | :--- | :--- | :--- |
| **有限长序列** | $n$有限区间有值 | 整个Z平面 (除$0$或$\infty$) | 无（仅有平凡极点） | $\delta(n), R_N(n)$ |
| **右边序列** | $n \ge n_0$ (因果类) | **圆外**区域 $|z| > R_x$ | ROC在最外层极点之外 | $a^n u(n)$ |
| **左边序列** | $n \le n_0$ (反因果类) | **圆内**区域 $|z| < R_x$ | ROC在最里层极点之内 | $-a^n u(-n-1)$ |
| **双边序列** | $n$延伸至 $\pm \infty$ | **圆环**区域 $R_{x1} < |z| < R_{x2}$ | 夹在两个极点之间 | $a^{|n|}$ |

*   **关键结论**：
    *   **因果序列**（$n<0$时为0）$\Leftrightarrow$ ROC 为 $|z| > R$（包含 $\infty$ 点）。
    *   **稳定性判据**：若单位圆（$|z|=1$）包含在 ROC 内，则系统/序列是稳定的。

---

### **2. 常用Z变换对（背诵表）**

熟记这些变换对是快速解题的前提。

| 时域序列 $x(n)$ | Z变换 $X(z)$ | 收敛域 ROC | 备注 |
| :--- | :--- | :--- | :--- |
| $\delta(n)$ | $1$ | 整个Z平面 | 频谱是平坦的 |
| $u(n)$ | $\frac{1}{1-z^{-1}} = \frac{z}{z-1}$ | $|z| > 1$ | 极点在 $z=1$ |
| **$a^n u(n)$** | **$\frac{1}{1-az^{-1}} = \frac{z}{z-a}$** | **$|z| > |a|$** | **最重要公式(因果)** |
| **$-a^n u(-n-1)$**| **$\frac{1}{1-az^{-1}} = \frac{z}{z-a}$**| **$|z| < |a|$** | **最重要公式(反因果)** |
| $n a^n u(n)$ | $\frac{az^{-1}}{(1-az^{-1})^2}$ | $|z| > |a|$ | 重极点情况 |

> **注意**：$a^n u(n)$ 和 $-a^n u(-n-1)$ 的 $X(z)$ 表达式完全相同！**唯一的区别在于 ROC**。这就是为什么说“Z变换必须带ROC”的原因。

---

### **3. Z变换的重要性质**

掌握性质可以避免死算级数。

1.  **线性 (Linearity)**
    $a x_1(n) + b x_2(n) \leftrightarrow a X_1(z) + b X_2(z)$
    *   ROC 是两者 ROC 的交集。

2.  **移位性质 (Time Shifting) —— 解差分方程的核心**
    $$ x(n-m) \leftrightarrow z^{-m} X(z) $$
    *   **口诀**：迟到（减$m$）是负次幂，早退（加$m$）是正次幂。

3.  **指数加权 (Scaling in z-domain)**
    $$ a^n x(n) \leftrightarrow X(z/a) $$
    *   *解释*：时域乘以指数序列，对应频域（Z域）的尺度变换（极点半径缩放）。

4.  **时域微分 (Differentiation in z-domain)**
    $$ n x(n) \leftrightarrow -z \frac{dX(z)}{dz} $$

5.  **时域卷积 (Convolution) —— 系统的灵魂**
    $$ x(n) * h(n) \leftrightarrow X(z) \cdot H(z) $$
    *   **意义**：将时域复杂的卷积运算，转化为Z域简单的代数乘法。

6.  **初值定理 (Initial Value Theorem)**
    若 $x(n)$ 是因果序列，则 $x(0) = \lim_{z \to \infty} X(z)$。

---

### **4. 逆Z变换 (Inverse Z-Transform)**

已知 $X(z)$ 求 $x(n)$。虽然有围线积分法（留数法）和长除法（幂级数法），但工程和考试中**90%的情况使用部分分式展开法**。

#### **核心方法：部分分式展开法**
**步骤**：
1.  **除以 z**：为了凑标准形式，先计算 $\frac{X(z)}{z}$。
2.  **因式分解**：找出分母的根（极点）。
3.  **展开**：将 $\frac{X(z)}{z}$ 展开为 $\sum \frac{A_k}{z-p_k}$ 的形式。
4.  **求系数**：利用留数法求出 $A_k$。
    $$ A_k = \left. (z-p_k) \frac{X(z)}{z} \right|_{z=p_k} $$
5.  **乘回 z**：得到 $X(z) = \sum A_k \frac{z}{z-p_k} = \sum A_k \frac{1}{1-p_k z^{-1}}$。
6.  **查表反变换（最关键一步）**：
    *   根据给定的 **ROC**，判断每一项 $\frac{z}{z-p_k}$ 对应的是因果序列还是反因果序列。
    *   若 ROC 在极点 $p_k$ **外** ($|z|>|p_k|$) $\to$ 对应 $p_k^n u(n)$。
    *   若 ROC 在极点 $p_k$ **内** ($|z|<|p_k|$) $\to$ 对应 $-p_k^n u(-n-1)$。

---

### **5. 系统函数与频率响应**

#### **5.1 系统函数 $H(z)$**
对于LTI系统，$Y(z) = X(z)H(z)$，则 $H(z) = \frac{Y(z)}{X(z)} = \sum h(n)z^{-n}$。
*   **零极点图**：
    *   **零点 (Zeros)**：使 $H(z)=0$ 的点。
    *   **极点 (Poles)**：使 $H(z)=\infty$ 的点。
    *   极点决定系统的**稳定性**和**自然响应**模态。

#### **5.2 Z变换与DTFT的关系**
$$ z = e^{j\omega} $$
即：**DTFT是Z变换在单位圆上的取值**。
*   $X(e^{j\omega}) = X(z)|_{z=e^{j\omega}}$
*   **存在条件**：ROC必须包含单位圆（即包含 $|z|=1$）。若单位圆不在ROC内，则DTFT不存在（系统不稳定）。

---

## **三、 典型例题解析**

### **例题1：求逆Z变换（考察ROC判别）**
已知 $X(z) = \frac{3z^2 - z}{(z-1)(z-0.5)}$，求 $x(n)$。
**解**：
1.  **标准化**：$\frac{X(z)}{z} = \frac{3z-1}{(z-1)(z-0.5)}$。
2.  **展开**：$\frac{X(z)}{z} = \frac{A}{z-1} + \frac{B}{z-0.5}$。
    *   $A = \left. \frac{3z-1}{z-0.5} \right|_{z=1} = \frac{2}{0.5} = 4$
    *   $B = \left. \frac{3z-1}{z-1} \right|_{z=0.5} = \frac{0.5}{-0.5} = -1$
3.  **整理**：$X(z) = \frac{4z}{z-1} - \frac{z}{z-0.5} = \frac{4}{1-z^{-1}} - \frac{1}{1-0.5z^{-1}}$。
4.  **根据ROC分类讨论**：
    *   **情况1：ROC $|z|>1$**（因果系统）：
        两个极点都在ROC内侧。
        $x(n) = 4(1)^n u(n) - (0.5)^n u(n)$。
    *   **情况2：ROC $|z|<0.5$**（反因果）：
        两个极点都在ROC外侧。
        $x(n) = -4(1)^n u(-n-1) + (0.5)^n u(-n-1)$。
        *(注意负号的变化)*
    *   **情况3：ROC $0.5 < |z| < 1$**（双边）：
        极点0.5在内侧（因果），极点1在外侧（反因果）。
        $x(n) = -4(1)^n u(-n-1) - (0.5)^n u(n)$。

### **例题2：因果稳定性判断**
某系统 $H(z) = \frac{1}{1 - 2z^{-1}}$，ROC为 $|z|<2$。
1.  该系统稳定吗？
    *   答：单位圆 $|z|=1$ 包含在 ROC ($|z|<2$) 内，所以**稳定**。
2.  该系统因果吗？
    *   答：ROC 是 $|z|<2$（圆内），说明是左边序列（反因果）。故**非因果**。
3.  求 $h(n)$。
    *   对应反因果公式：$h(n) = -(2)^n u(-n-1)$。

---

## **四、 第二讲小结**

1.  **Z变换是核心**：将差分方程转化为代数方程。
2.  **ROC定乾坤**：
    *   $|z| > R$ $\to$ 右边序列 (因果)。
    *   $|z| < R$ $\to$ 左边序列。
    *   包含单位圆 $\to$ 稳定。
3.  **逆变换要点**：部分分式展开后，**必须**看ROC来决定写 $u(n)$ 还是 $-u(-n-1)$。
4.  **联系**：$Z=e^{j\omega}$ 连接了Z域和频域。

## **五、 课后思考（为下一讲铺垫）**
*   我们现在可以用Z变换分析离散系统了，但在计算机里，所有的信号都是有限长的，而且频率也必须是离散的（现在的DTFT频率 $\omega$ 还是连续的）。
*   如何让计算机能计算频谱？我们需要一种**时域离散、频域也离散**的变换。
*   这就是下一讲的主角——**离散傅里叶变换 (DFT)**。

---
好的，按照我们的课程规划，今天进行**第3讲：系统的频域分析与系统函数**。

这一讲是将前两讲（时域离散信号、Z变换）打通的关键。我们将揭示**Z平面上的零极点分布是如何决定一个滤波器的频率响应特性的**。这是所有数字滤波器设计（后续的第4、5模块）的理论核心。

---

# **第3讲：系统的频域分析与系统函数**

## **一、 学习目标**
1.  **掌握** DTFT（离散时间傅里叶变换）的定义、物理意义及其周期性特征。
2.  **深刻理解** Z变换与DTFT的几何关系（单位圆上的投影）。
3.  **熟练掌握** 系统函数 $H(z)$ 与频率响应 $H(e^{j\omega})$ 的转换。
4.  **精通** 利用零极点分布图（几何法）定性分析系统的幅频特性和相频特性（**核心难点与直觉培养**）。

---

## **二、 核心内容精讲**

### **1. 离散时间傅里叶变换 (DTFT)**

#### **1.1 定义与物理意义**
对于非周期离散序列 $x(n)$，其 DTFT 定义为：
$$ X(e^{j\omega}) = \sum_{n=-\infty}^{\infty} x(n) e^{-j\omega n} $$
*   **物理意义**：将时域离散信号分解为不同频率 $\omega$ 的复指数信号的加权和。$X(e^{j\omega})$ 代表了信号在数字频率 $\omega$ 处的频谱密度。

#### **1.2 关键特性（必考）**
1.  **周期性**：$X(e^{j\omega})$ 是 $\omega$ 的周期函数，周期为 $2\pi$。
    *   *原因*：$e^{j(\omega+2\pi)n} = e^{j\omega n} \cdot e^{j2\pi n} = e^{j\omega n}$（因为 $n$ 是整数）。
    *   *结论*：我们通常只分析 $[-\pi, \pi]$ 或 $[0, 2\pi]$ 区间。
2.  **对称性**：若 $x(n)$ 为实序列，则：
    *   幅度谱 $|X(e^{j\omega})|$ 是**偶对称**的。
    *   相位谱 $\angle X(e^{j\omega})$ 是**奇对称**的。

#### **1.3 逆变换 (IDTFT)**
$$ x(n) = \frac{1}{2\pi} \int_{-\pi}^{\pi} X(e^{j\omega}) e^{j\omega n} d\omega $$
*   *注意*：积分区间是一个周期 $2\pi$。

---

### **2. Z变换与DTFT的关系**

这是连接“复频域”与“频域”的桥梁。

#### **2.1 数学关系**
回顾Z变换定义：$X(z) = \sum x(n) z^{-n}$。
令 $z = r e^{j\omega}$，若取 $r=1$（即 $|z|=1$），则：
$$ X(z)|_{z=e^{j\omega}} = \sum x(n) e^{-j\omega n} = X(e^{j\omega}) $$

#### **2.2 几何意义（单位圆）**
*   **Z平面**：整个复平面。
*   **DTFT**：仅是Z变换在**单位圆**上的取值。
    *   $\omega$ 对应单位圆上的角度。
    *   $\omega = 0$：对应 $z=1$（直流分量）。
    *   $\omega = \pi$：对应 $z=-1$（最高频率分量）。

#### **2.3 存在条件**
*   只有当Z变换的收敛域（ROC）**包含单位圆**时，DTFT才存在（即系统稳定）。
*   *反例*：$x(n) = 2^n u(n)$，其ROC为 $|z|>2$，不包含单位圆，故其DTFT不存在（系统不稳定，无稳态频率响应）。

---

### **3. 系统函数与频率响应**

对于LTI系统，输入 $x(n)$ 与输出 $y(n)$ 的关系在Z域为 $Y(z) = X(z)H(z)$。

#### **3.1 系统函数 $H(z)$**
$$ H(z) = \frac{\sum_{k=0}^{M} b_k z^{-k}}{1 - \sum_{k=1}^{N} a_k z^{-k}} = A \frac{\prod_{r=1}^{M} (z - c_r)}{\prod_{k=1}^{N} (z - d_k)} $$
*   $c_r$：系统的**零点** (Zeros)。
*   $d_k$：系统的**极点** (Poles)。

#### **3.2 频率响应 $H(e^{j\omega})$**
当系统稳定时（极点都在单位圆内），令 $z=e^{j\omega}$，得到频率响应：
$$ H(e^{j\omega}) = |H(e^{j\omega})| e^{j\phi(\omega)} $$
*   **幅频特性** $|H(e^{j\omega})|$：决定了系统对不同频率信号的增益（滤波作用）。
*   **相频特性** $\phi(\omega)$：决定了系统对不同频率信号的延迟。

---

### **4. 几何法分析频率响应（直觉培养核心）**

这是不进行复杂计算，直接看图判断滤波器类型（低通/高通/带通）的绝技。

#### **4.1 矢量法原理**
对于单位圆上任意一点 $A$（代表频率 $\omega$）：
*   **零点矢量**：从零点指向 $A$ 的矢量，记为 $\vec{V}_{z}$。
*   **极点矢量**：从极点指向 $A$ 的矢量，记为 $\vec{V}_{p}$。

幅度响应近似为：
$$ |H(e^{j\omega})| \propto \frac{\text{所有零点矢量长度之积}}{\text{所有极点矢量长度之积}} $$

#### **4.2 零极点分布对频响的影响规律**
1.  **极点 (Pole) 的作用**：**“撑起”频谱**。
    *   当 $\omega$ 旋转到极点附近时，分母变小，幅度 $|H|$ 变大（产生波峰）。
    *   极点越靠近单位圆，波峰越尖锐（Q值越高）。
2.  **零点 (Zero) 的作用**：**“压低”频谱**。
    *   当 $\omega$ 旋转到零点附近时，分子变小，幅度 $|H|$ 变小（产生波谷）。
    *   若零点正好在单位圆上，则该频率处的增益为0（完全截止）。

#### **4.3 典型滤波器类型的零极点分布**
*   **低通滤波器 (Low Pass)**：
    *   极点集中在 $z=1$ 附近（右半平面，$\omega=0$附近）。
    *   零点集中在 $z=-1$ 附近（左半平面，$\omega=\pi$附近）。
*   **高通滤波器 (High Pass)**：
    *   极点集中在 $z=-1$ 附近。
    *   零点集中在 $z=1$ 附近。
*   **带通滤波器 (Band Pass)**：
    *   极点分布在特定角度 $\pm \omega_0$ 附近。
*   **全通滤波器 (All Pass)**：
    *   零极点关于单位圆呈镜像对称分布，幅度恒为常数，只改变相位。

---

### **5. 帕斯瓦尔定理 (Parseval's Theorem)**

$$ \sum_{n=-\infty}^{\infty} |x(n)|^2 = \frac{1}{2\pi} \int_{-\pi}^{\pi} |X(e^{j\omega})|^2 d\omega $$
*   **物理意义**：信号在时域的总能量等于其在频域的总能量。
*   **应用**：计算滤波器输出噪声能量时非常有用。

---

## **三、 典型例题解析**

### **例题1：一阶系统的频响分析**
已知系统差分方程为：$y(n) - 0.8y(n-1) = x(n)$。
1.  求系统函数 $H(z)$ 并画出零极点图。
2.  判断滤波器类型（低通/高通）。
3.  求 $\omega=0$ 和 $\omega=\pi$ 处的幅度。

**解**：
1.  **求 $H(z)$**：
    $$ H(z) = \frac{1}{1 - 0.8z^{-1}} = \frac{z}{z - 0.8} $$
    *   **零点**：$z=0$ (原点)。
    *   **极点**：$z=0.8$ (实轴上，靠近单位圆右侧)。
    *   **ROC**：$|z|>0.8$ (因果稳定)。

2.  **几何分析**：
    *   随着点在单位圆上从 $\omega=0$ (右侧) 移动到 $\omega=\pi$ (左侧)。
    *   在 $\omega=0$ 处，距离极点 $0.8$ 最近 (距离为0.2)，分母最小，幅度最大。
    *   在 $\omega=\pi$ 处，距离极点 $0.8$ 最远 (距离为1.8)，分母最大，幅度最小。
    *   **结论**：低频增益大，高频增益小 $\to$ **低通滤波器**。

3.  **计算幅度**：
    *   $|H(e^{j0})| = \frac{1}{1-0.8} = 5$。
    *   $|H(e^{j\pi})| = \frac{1}{1-0.8(-1)} = \frac{1}{1.8} \approx 0.56$。

### **例题2：梳状滤波器**
$H(z) = 1 - z^{-4}$。分析其幅频特性。
**解**：
*   零点方程：$z^4 = 1$。
*   零点位置：$z = 1, j, -1, -j$ (单位圆上均匀分布的4个点)。
*   **频率响应**：
    在 $\omega = 0, \pi/2, \pi, 3\pi/2$ 处，单位圆上的点正好碰到零点。
    因此在这些频率处，增益为0。
    这是一个**梳状滤波器** (Comb Filter)，用于滤除特定的谐波干扰。

---

## **四、 第三讲小结**

1.  **联系**：DTFT 是 Z变换在单位圆上的特例（前提是系统稳定）。
2.  **直觉**：看到 $H(z)$ 的极点，要能立刻想象出“帐篷支柱”，极点把单位圆上的幅频响应顶起来；看到零点，要想象“钉子”，把幅频响应钉在地上。
3.  **关键频率点**：
    *   $z=1 \leftrightarrow \omega=0$ (DC, 低频)。
    *   $z=-1 \leftrightarrow \omega=\pi$ (Nyquist, 高频)。

## **五、 课后思考（为下一讲铺垫）**
*   现在的DTFT频率 $\omega$ 是连续变量，计算机无法处理连续的频谱曲线。
*   如果我们在频域上也进行“采样”，只取有限个点，这会对应时域的什么变化？
*   这将引出下一讲的主题：**离散傅里叶变换 (DFT)** —— 全数字处理的最后一块拼图。

---
好的，我们继续按照规划进行**第4讲：信号的采样与重建**。

这一讲是连接模拟世界（现实物理信号）与数字世界（计算机处理）的桥梁。理解这一讲，你才能明白为什么我们要在电脑里处理信号，以及在这个过程中我们到底损失了什么、保留了什么。

---

# **第4讲：信号的采样与重建**

## **一、 学习目标**
1.  **深刻理解** 模拟信号数字化的全过程（A/D转换）。
2.  **掌握** 理想采样在频域的数学本质——**频谱的周期延拓**（本讲核心）。
3.  **牢记** 奈奎斯特采样定理（Nyquist Sampling Theorem）及其推导逻辑。
4.  **理解** 混叠（Aliasing）现象产生的原因及抗混叠滤波器的必要性。
5.  **掌握** 信号重建（D/A转换）的原理：理想内插公式（Sinc函数）。

---

## **二、 核心内容精讲**

### **1. 模拟信号数字化的模型**

将一个连续的模拟信号 $x_a(t)$ 转换为数字序列 $x(n)$，实际上包含三个步骤：

1.  **采样 (Sampling)**：时间离散化。每隔 $T$ 秒取一个点。
    *   *这是本讲讨论的重点，因为它决定了频谱的结构。*
2.  **量化 (Quantization)**：幅度离散化。将采样值近似为有限精度的数值。
    *   *这会引入量化噪声（非线性误差），将在第12讲详细讨论。*
3.  **编码 (Coding)**：将量化后的数值转换为二进制码。

**关键参数**：
*   **采样周期**：$T$ (单位：秒/点)
*   **采样频率**：$f_s = 1/T$ (单位：Hz) 或 $\Omega_s = 2\pi f_s$ (单位：rad/s)

---

### **2. 理想采样的数学描述（时域与频域）**

为了从数学上分析采样，我们引入**理想采样**模型：用模拟信号乘以为周期脉冲串。

#### **2.1 时域描述**
设模拟信号为 $x_a(t)$，采样脉冲串为 $p(t) = \sum_{n=-\infty}^{\infty} \delta(t-nT)$。
理想采样信号 $\hat{x}_a(t)$ 为：
$$ \hat{x}_a(t) = x_a(t) \cdot p(t) = \sum_{n=-\infty}^{\infty} x_a(nT) \delta(t-nT) $$
*   **注意**：$\hat{x}_a(t)$ 仍然是一个连续时间信号（由一串强度不同的冲激函数组成），它与离散序列 $x(n)$ 的关系是数值对应：$x(n) = x_a(nT)$。

#### **2.2 频域描述（核心推导）**
根据傅里叶变换的**卷积定理**：时域相乘对应频域卷积（再除以 $2\pi$）。
$$ \hat{X}_a(j\Omega) = \frac{1}{2\pi} X_a(j\Omega) * P(j\Omega) $$

1.  **脉冲串的频谱**：周期脉冲串 $p(t)$ 的傅里叶变换仍然是脉冲串（频域也是周期的）：
    $$ P(j\Omega) = \frac{2\pi}{T} \sum_{k=-\infty}^{\infty} \delta(\Omega - k\Omega_s) $$
    其中 $\Omega_s = \frac{2\pi}{T}$ 是采样角频率。

2.  **卷积结果**：
    $$ \hat{X}_a(j\Omega) = \frac{1}{T} \sum_{k=-\infty}^{\infty} X_a(j(\Omega - k\Omega_s)) $$

#### **2.3 物理意义（必背结论）**
**理想采样在频域的效果是：将原模拟信号的频谱 $X_a(j\Omega)$ 以采样频率 $\Omega_s$ 为周期进行无限次的周期延拓（复制和平移），幅度缩放为 $1/T$。**

*   $k=0$ 时：主频谱（基带）。
*   $k=\pm 1, \pm 2...$ 时：高频镜像频谱。

---

### **3. 奈奎斯特采样定理**

#### **3.1 混叠现象 (Aliasing)**
既然采样后的频谱是原频谱的周期延拓，那么：
*   如果原信号是**带限**的（最高频率为 $\Omega_{max}$），且采样频率 $\Omega_s$ 足够大，各个延拓分量之间就会有空隙，互不干扰。
*   如果 $\Omega_s$ 太小，使得 $\Omega_s - \Omega_{max} < \Omega_{max}$，即 $\Omega_s < 2\Omega_{max}$，那么相邻的频谱周期就会发生**重叠**。
*   这种重叠导致高频成分“伪装”成了低频成分，无法区分，这就是**混叠**。

#### **3.2 采样定理**
为了能从采样信号中无失真地恢复出原模拟信号，必须满足：
$$ \Omega_s \ge 2\Omega_{max} \quad \text{或} \quad f_s \ge 2f_{max} $$
*   **奈奎斯特频率 (Nyquist Frequency)**：$f_s/2$（即折叠频率）。信号频率超过这个值就会发生混叠。
*   **奈奎斯特率 (Nyquist Rate)**：$2f_{max}$。这是恢复信号所需的最低采样率。

#### **3.3 模拟频率与数字频率的映射关系**
$$ \omega = \Omega T = \frac{\Omega}{f_s} \cdot 2\pi $$
*   模拟频率 $\Omega$：范围 $-\infty \sim +\infty$。
*   数字频率 $\omega$：由于数字谱的周期性，我们只关注 $-\pi \sim \pi$。
*   **对应关系**：
    *   $\Omega = 0 \leftrightarrow \omega = 0$ (直流)
    *   $\Omega = \pm \frac{\Omega_s}{2} \leftrightarrow \omega = \pm \pi$ (折叠频率)
    *   这就解释了为什么 $\omega = \pi$ 代表数字信号的最高频率。

---

### **4. 信号的重建 (D/A转换)**

如果我们满足了采样定理，频谱没有混叠，如何变回模拟信号？
答案是：**低通滤波**。

#### **4.1 频域重建**
采样后的频谱 $\hat{X}_a(j\Omega)$ 包含了无数个周期延拓。要恢复原信号，只需要把 $k=0$ 的那个主频谱（基带）切出来，把高频的复制品滤掉。

需要一个**理想低通滤波器** $H_r(j\Omega)$：
*   **截止频率**：$\Omega_c = \Omega_s / 2$
*   **增益**：$T$ (为了抵消采样带来的 $1/T$ 衰减)
$$ X_a(j\Omega) = \hat{X}_a(j\Omega) \cdot H_r(j\Omega) $$

#### **4.2 时域重建（内插公式）**
频域相乘 = 时域卷积。
理想低通滤波器的冲激响应是 Sinc 函数：
$$ h_r(t) = \frac{\sin(\frac{\pi t}{T})}{\frac{\pi t}{T}} = \text{sinc}(\frac{t}{T}) $$
重建公式（Whittaker-Shannon 插值公式）：
$$ x_a(t) = \sum_{n=-\infty}^{\infty} x(n) \cdot \frac{\sin[\frac{\pi}{T}(t-nT)]}{\frac{\pi}{T}(t-nT)} $$
*   **物理意义**：模拟信号是无数个以采样点为中心的 Sinc 函数的加权叠加。

---

### **5. 实际工程中的问题**

#### **5.1 抗混叠滤波器 (Anti-aliasing Filter)**
现实中的信号往往不是严格带限的（有噪声、高频干扰）。
*   **措施**：在 A/D 转换**之前**，必须加一个模拟低通滤波器，将高于 $f_s/2$ 的频率成分滤除，强行使信号带限，防止混叠。

#### **5.2 零阶保持 (Zero-Order Hold, ZOH)**
理想的 Sinc 内插函数是无限长的，是非因果的，物理不可实现。
*   **实际D/A**：使用零阶保持器，将采样点保持一个周期 $T$，形成阶梯波。
*   **后果**：ZOH 的频谱是 Sinc 函数形状，会导致高频衰减（孔径效应）。需要后续加一个模拟平滑滤波器进行补偿。

---

## **三、 典型例题解析**

### **例题1：混叠频率计算**
对模拟信号 $x_a(t) = \cos(2\pi \cdot 60 t)$ 进行采样，采样率 $f_s = 100 \text{Hz}$。
1.  求离散序列 $x(n)$。
2.  求重建后的模拟信号 $y_a(t)$。

**解**：
1.  **离散化**：
    $x(n) = x_a(nT) = \cos(2\pi \cdot 60 \cdot \frac{n}{100}) = \cos(1.2\pi n)$。
    由于数字频率周期性，$\cos(1.2\pi n) = \cos((2\pi - 0.8\pi)n) = \cos(0.8\pi n)$。
    所以，数字频率 $\omega = 0.8\pi$。

2.  **重建**：
    D/A 转换将数字频率映射回模拟基带频率 ($-\pi \sim \pi$ 对应 $-f_s/2 \sim f_s/2$)。
    $\omega = 0.8\pi \rightarrow \Omega = \frac{\omega}{T} = 0.8\pi \cdot f_s = 0.8\pi \cdot 100 = 80\pi$。
    对应的模拟频率 $f = 40 \text{Hz}$。
    所以 $y_a(t) = \cos(2\pi \cdot 40 t)$。
    *   **结论**：60Hz 的信号被错误地恢复成了 40Hz，这就是混叠（$60 = 100 - 40$）。

### **例题2：采样率选择**
若信号 $x_a(t) = \sin(200\pi t) + 3\cos(500\pi t)$。求奈奎斯特采样率。
**解**：
*   分量1频率：$f_1 = 100 \text{Hz}$。
*   分量2频率：$f_2 = 250 \text{Hz}$。
*   最高频率 $f_{max} = 250 \text{Hz}$。
*   奈奎斯特采样率 $f_s \ge 2 f_{max} = 500 \text{Hz}$。

---

## **四、 第4讲小结**

1.  **核心机制**：时域离散化 $\Longleftrightarrow$ 频域周期延拓。这是理解混叠的根本。
2.  **三大定律**：
    *   采样前：**抗混叠滤波**（保证带限）。
    *   采样时：**$f_s \ge 2f_{max}$**（防止重叠）。
    *   重建时：**理想低通滤波**（切除延拓分量）。
3.  **内插本质**：在时域是用 Sinc 函数去“填补”采样点之间的空隙。

## **五、 课后思考（为下一讲铺垫）**
*   我们现在有了离散序列 $x(n)$。虽然我们可以计算它的 DTFT $X(e^{j\omega})$，但 $X(e^{j\omega})$ 是 $\omega$ 的连续函数，计算机还是存不下来，算不了。
*   **问题**：如何在频域上也进行“采样”，让频谱也变成离散的？
*   **预告**：下一讲我们将介绍 **离散傅里叶变换 (DFT)**，彻底解决计算机处理频谱的问题。

---
好的，我们现在开始**第5讲：DFS与DFT的定义及性质**。

如果说前几讲是在为数字信号处理打地基（信号、系统、采样），那么这一讲就是**正式进入“数字频域”的核心**。因为只有到了DFT，我们才真正拥有了**计算机可以计算的频谱**。这一讲的概念非常重要，特别是“隐含周期性”和“圆周卷积”，是后续理解FFT和滤波器设计的关键。

---

# **第5讲：DFS与DFT的定义及性质**

## **一、 学习目标**
1.  **理解** 离散傅里叶级数（DFS）与离散傅里叶变换（DFT）的逻辑关系。
2.  **掌握** DFT的定义式、物理意义，以及它与DTFT、Z变换的联系（**频域采样定理**）。
3.  **精通** DFT的隐含周期性引发的特殊性质：**圆周移位**与**圆周卷积**。
4.  **解决核心问题**：如何利用圆周卷积（DFT）计算线性卷积（LTI系统响应）而不产生混叠（**零填充法**）。

---

## **二、 核心内容精讲**

### **1. 从连续到离散的最后一步：DFS的引入**

在第3讲中，我们学习了DTFT（离散时间傅里叶变换）。DTFT虽然处理了时域离散信号，但其频域频谱 $X(e^{j\omega})$ 却是连续函数（周期为$2\pi$）。计算机无法存储和计算连续曲线，因此我们需要**在频域上也进行离散化**。

#### **1.1 离散傅里叶级数 (DFS)**
如果我们强制时域序列是**周期性**的（周期为 $N$），记为 $\tilde{x}(n)$。根据傅里叶级数理论，周期信号的频谱也是离散的（线谱）。

*   **DFS定义对**：
    $$ \tilde{X}(k) = \sum_{n=0}^{N-1} \tilde{x}(n) W_N^{nk}, \quad k = 0, 1, \dots, N-1 $$
    $$ \tilde{x}(n) = \frac{1}{N} \sum_{k=0}^{N-1} \tilde{X}(k) W_N^{-nk}, \quad n = 0, 1, \dots, N-1 $$

*   **旋转因子 $W_N$**：
    $$ W_N = e^{-j\frac{2\pi}{N}} $$
    *   **重要性质**：$W_N$ 具有周期性（$W_N^{k+N} = W_N^k$）和对称性。这将在下一讲FFT算法中大显神威。

*   **物理意义**：
    时域周期为 $N$ 的序列 $\Leftrightarrow$ 频域周期为 $N$ 的离散系数。
    即：**时域离散周期 $\longleftrightarrow$ 频域离散周期**。

---

### **2. 离散傅里叶变换 (DFT)**

现实中大多数信号是**有限长**的，而非周期的。为了利用DFS的离散特性，我们采用“**周期延拓**”的思想。

#### **2.1 从有限长序列到DFT**
设有一个长度为 $N$ 的有限长序列 $x(n)$（在区间 $0 \le n \le N-1$ 有值，其余为0）。
1.  **延拓**：将 $x(n)$ 以 $N$ 为周期进行重复，得到周期序列 $\tilde{x}(n)$。
2.  **变换**：对 $\tilde{x}(n)$ 做DFS，得到周期频谱 $\tilde{X}(k)$。
3.  **截取**：取 $\tilde{X}(k)$ 的一个主值区间（$0 \le k \le N-1$），定义为 **DFT**。

#### **2.2 DFT 定义公式（全书最重要公式）**
正变换（分析）：
$$ X(k) = \text{DFT}[x(n)] = \sum_{n=0}^{N-1} x(n) W_N^{nk}, \quad 0 \le k \le N-1 $$

逆变换（合成）：
$$ x(n) = \text{IDFT}[X(k)] = \frac{1}{N} \sum_{k=0}^{N-1} X(k) W_N^{-nk}, \quad 0 \le n \le N-1 $$

#### **2.3 DFT 与 DTFT、Z变换的关系**
这是理解DFT物理意义的关键。
*   **Z变换**：$X(z)$ 是整个Z平面的函数。
*   **DTFT**：$X(e^{j\omega})$ 是Z变换在**单位圆**上的取值（连续曲线）。
*   **DFT**：$X(k)$ 是 DTFT 在区间 $[0, 2\pi]$ 上的 **$N$点等间隔采样**。
    $$ X(k) = X(e^{j\omega}) \Big|_{\omega = \frac{2\pi}{N}k} $$
    *   **频域采样定理**：时域有限长序列，对应频域连续频谱。若在频域采样 $N$ 点，能否恢复原信号？
        *   只有当频域采样点数 $N \ge$ 序列长度 $L$ 时，才能无失真恢复（时域不混叠）。

---

### **3. DFT 的重要性质**

由于DFT本质上是借用了周期序列的DFS，因此它具有**隐含周期性**。这是导致DFT性质与DTFT（线性性质）不同的根本原因。

#### **3.1 隐含周期性**
虽然 $x(n)$ 和 $X(k)$ 定义在有限区间，但在进行DFT运算性质推导时，必须将它们看作是**周期为 $N$ 的序列**。
*   索引超出范围时，要对 $N$ 取模：$x((-1)) = x(N-1)$。

#### **3.2 圆周移位 (Circular Shift)**
若 $x(n) \leftrightarrow X(k)$，则：
$$ x((n-m))_N = x((n-m) \pmod N) \leftrightarrow W_N^{km} X(k) $$
*   **形象理解**：序列在一个首尾相接的圆环上移动。移出右边的点会从左边回来。
*   *对比*：线性移位是移出去的点就消失了，空位补零。

#### **3.3 圆周卷积 (Circular Convolution)**
若 $x_1(n)$ 和 $x_2(n)$ 都是长度为 $N$ 的序列，
$$ x_1(n) \otimes x_2(n) = \left[ \sum_{m=0}^{N-1} x_1(m) x_2((n-m))_N \right] R_N(n) \leftrightarrow X_1(k) X_2(k) $$
*   **频域相乘 $\Leftrightarrow$ 时域圆周卷积**。
*   **注意**：前面的DTFT性质是“频域相乘 $\Leftrightarrow$ 时域**线性**卷积”。在DFT中，变成了**圆周**卷积。

#### **3.4 帕斯瓦尔定理 (DFT形式)**
$$ \sum_{n=0}^{N-1} |x(n)|^2 = \frac{1}{N} \sum_{k=0}^{N-1} |X(k)|^2 $$

---

### **4. 线性卷积与圆周卷积的关系（重难点）**

这是工程应用的核心问题：我们希望利用FFT（快速计算DFT）来计算线性卷积（LTI系统响应），但FFT直接计算出来的是圆周卷积。如何建立两者的联系？

#### **4.1 线性卷积回顾**
设 $x(n)$ 长为 $N$，$h(n)$ 长为 $M$。
线性卷积 $y_L(n) = x(n) * h(n)$ 的长度为 **$L = N + M - 1$**。

#### **4.2 圆周卷积的混叠**
如果我们将 $x(n)$ 和 $h(n)$ 做 $L$-点 DFT，相乘后再 IDFT，得到的是 $L$-点圆周卷积 $y_C(n)$。
$$ y_C(n) = \sum_{r=-\infty}^{\infty} y_L(n + rL) $$
即：**圆周卷积是线性卷积以 $L$ 为周期的周期延拓在主值区间上的叠加（混叠）。**

#### **4.3 如何使圆周卷积 = 线性卷积？**
为了防止周期延拓时发生混叠，必须保证延拓周期（即DFT的点数）足够长。
*   **条件**：DFT的点数 $L_{DFT}$ 必须满足：
    $$ L_{DFT} \ge N + M - 1 $$
*   **方法（零填充，Zero Padding）**：
    1.  将 $x(n)$ 补零至长度 $L_{DFT}$。
    2.  将 $h(n)$ 补零至长度 $L_{DFT}$。
    3.  分别计算 DFT，相乘，再 IDFT。
    4.  结果即为线性卷积。

---

## **三、 典型例题解析**

### **例题1：DFT计算**
设 $x(n) = \{1, 2, 0, 1\}$ (长度 $N=4$)。计算其DFT $X(k)$。
**解**：利用矩阵形式或定义公式（$W_4 = -j$）。
*   $k=0$: $\sum x(n) = 1+2+0+1 = 4$
*   $k=1$: $\sum x(n)(-j)^n = 1 + 2(-j) + 0(-1) + 1(j) = 1 - j$
*   $k=2$: $\sum x(n)(-1)^n = 1 - 2 + 0 - 1 = -2$
*   $k=3$: $\sum x(n)(j)^n = 1 + 2(j) + 0(-1) + 1(-j) = 1 + j$
*   $X(k) = \{4, 1-j, -2, 1+j\}$。

### **例题2：圆周移位**
设 $x(n) = \{1, 2, 3, 4\}$ ($N=4$)。求 $x((n-1))_4$。
**解**：
*   这是右移1位，但在圆周上。
*   最后一位（4）移出后，回到第一位。
*   结果：$\{4, 1, 2, 3\}$。

### **例题3：圆周卷积计算**
设 $x_1(n)=\{1, 2\}$, $x_2(n)=\{2, 1\}$。
1.  计算线性卷积。
2.  计算4点圆周卷积。
3.  计算2点圆周卷积。

**解**：
1.  **线性卷积**：长度 $2+2-1=3$。
    $y_L = \{1\times2, 1\times1+2\times2, 2\times1\} = \{2, 5, 2\}$。
2.  **4点圆周卷积**：
    补零至4点：$x_1=\{1,2,0,0\}, x_2=\{2,1,0,0\}$。
    DFT长度 $4 \ge 3$，无混叠。
    $y_{C4} = \{2, 5, 2, 0\}$ (与线性卷积一致)。
3.  **2点圆周卷积**：
    DFT长度 $2 < 3$，发生混叠。
    $y_{C2}(0) = y_L(0) + y_L(2) + \dots = 2 + 2 = 4$。
    $y_{C2}(1) = y_L(1) + 0 = 5$。
    $y_{C2} = \{4, 5\}$ (混叠严重，错误结果)。

---

## **四、 第5讲小结**

1.  **DFT的本质**：是对连续频谱 $X(e^{j\omega})$ 的等间隔采样。采样的点数 $N$ 决定了频域分辨率。
2.  **隐含周期性**：使用DFT时，时刻要记住你处理的仿佛是一个无限循环的周期信号。
3.  **圆周卷积陷阱**：
    *   直接相乘DFT结果，对应时域圆周卷积。
    *   要想得到线性卷积（物理系统的真实响应），**必须补零**，使得 $L \ge N+M-1$。

## **五、 课后思考（为下一讲铺垫）**
*   DFT虽然解决了计算机处理频谱的理论问题，但计算复杂度是多少？
*   根据定义计算 $N$ 点DFT，需要 $N^2$ 次复数乘法。当 $N=1024$ 时，需要一百万次乘法。这在几十年前是无法接受的慢。
*   有没有办法利用 $W_N^{nk}$ 的对称性和周期性，把计算量降下来？
*   **预告**：下一讲我们将揭开 **FFT (快速傅里叶变换)** 的面纱，它将把 $O(N^2)$ 的复杂度降为 $O(N\log N)$，这是DSP历史上最伟大的算法之一。

---
好的，我们现在进行**第6讲：FFT算法原理（基2-FFT）**。

这一讲是数字信号处理中**里程碑式**的内容。1965年库利（Cooley）和图基（Tukey）发表FFT算法，被誉为“数字信号处理领域的原子弹爆炸”。它并没有改变DFT的定义，但它将计算效率提高了几个数量级，使得实时数字信号处理成为可能。

---

# **第6讲：FFT算法原理（基2-FFT）**

## **一、 学习目标**
1.  **理解痛点**：为什么直接计算DFT太慢（$O(N^2)$复杂度）？
2.  **掌握核心思想**：利用旋转因子 $W_N$ 的“三性”（周期性、对称性、可约性）进行“分治”。
3.  **精通推导**：**DIT-FFT**（按时间抽取）的算法推导及**蝶形运算**流图。
4.  **理解**：**DIF-FFT**（按频率抽取）的区别与联系。
5.  **掌握细节**：码位倒置（Bit-Reversal）、运算量对比、原位运算。

---

## **二、 核心内容精讲**

### **1. 直接计算DFT的问题**

回顾 $N$ 点DFT的定义公式：
$$ X(k) = \sum_{n=0}^{N-1} x(n) W_N^{nk}, \quad k=0, 1, \dots, N-1 $$

*   **复数乘法次数**：计算一个 $X(k)$ 需要 $N$ 次乘法。计算所有 $N$ 个 $X(k)$，共需 **$N^2$** 次复数乘法。
*   **复数加法次数**：计算一个 $X(k)$ 需要 $N-1$ 次加法。共需 **$N(N-1) \approx N^2$** 次复数加法。

**量级对比**：
*   若 $N=1024 (2^{10})$：
    *   DFT需要 $1024^2 \approx 100$ 万次乘法。
    *   FFT（$N\log_2 N$）仅需 $1024 \times 10 \approx 1$ 万次乘法。
    *   **效率提升了100倍！**

---

### **2. 解决问题的钥匙：$W_N$ 的性质**

FFT之所以能快，是因为它利用了旋转因子 $W_N = e^{-j\frac{2\pi}{N}}$ 的特殊性质来消除重复计算。

1.  **对称性**（相差半个周期，变负号）：
    $$ W_N^{k + N/2} = -W_N^k $$
    *   *证明*：$W_N^{N/2} = e^{-j\frac{2\pi}{N} \cdot \frac{N}{2}} = e^{-j\pi} = -1$。
2.  **周期性**（转一圈回到原点）：
    $$ W_N^{k + N} = W_N^k $$
3.  **可约性**（大点数变小点数）：
    $$ W_N^{nk} = W_{N/2}^{nk/2} $$
    *   *例子*：$W_8^2 = W_4^1$。这意味着8点DFT中的某些系数与4点DFT中的系数是一样的。

---

### **3. 按时间抽取 FFT (DIT-FFT)**

**核心思想（分治法）**：将长序列 $x(n)$ 按**奇偶**分为两组短序列，分别计算DFT，最后组合。

#### **3.1 算法推导（以N=8为例）**
设 $N=2^M$。将 $x(n)$ 分为偶数序列 $x(2r)$ 和奇数序列 $x(2r+1)$：
$$
\begin{aligned}
X(k) &= \sum_{n=0}^{N-1} x(n) W_N^{nk} \\
&= \sum_{r=0}^{N/2-1} x(2r) W_N^{2rk} + \sum_{r=0}^{N/2-1} x(2r+1) W_N^{(2r+1)k} \\
&= \sum_{r=0}^{N/2-1} x(2r) (W_N^2)^{rk} + W_N^k \sum_{r=0}^{N/2-1} x(2r+1) (W_N^2)^{rk}
\end{aligned}
$$
利用可约性 $W_N^2 = W_{N/2}$，可得：
$$ X(k) = \underbrace{\sum_{r=0}^{N/2-1} x(2r) W_{N/2}^{rk}}_{DFT[偶序列]} + W_N^k \underbrace{\sum_{r=0}^{N/2-1} x(2r+1) W_{N/2}^{rk}}_{DFT[奇序列]} $$

记 $G(k)$ 为偶数点的 $N/2$ 点DFT，$H(k)$ 为奇数点的 $N/2$ 点DFT。
$$ X(k) = G(k) + W_N^k H(k), \quad k = 0, \dots, N-1 $$

**问题**：$G(k)$ 和 $H(k)$ 的周期只有 $N/2$。当 $k \ge N/2$ 时怎么办？
利用 $G(k)$ 的周期性和 $W_N$ 的对称性：
*   当 $k < N/2$ 时：
    $$ X(k) = G(k) + W_N^k H(k) $$
*   当 $k \ge N/2$ 时（令 $k' = k - N/2$）：
    $$ X(k) = G(k') + W_N^{k'+N/2} H(k') = G(k') - W_N^{k'} H(k') $$

#### **3.2 蝶形运算 (Butterfly Calculation)**
这是FFT的基本单元。由上述两个公式构成了“蝶形结”：
*   输入：$G(k), H(k)$
*   输出：$X(k), X(k+N/2)$
*   运算：
    $$
    \begin{cases}
    X(k) &= G(k) + W_N^k H(k) \\
    X(k+N/2) &= G(k) - W_N^k H(k)
    \end{cases}
    $$
*   **特点**：只用一次复数乘法（$W_N^k H(k)$）就能算出两个输出值。

#### **3.3 运算流图的规律**
1.  **分级**：$N=2^M$ 点FFT共有 $M$ 级运算（$\log_2 N$级）。
2.  **输入倒序**：为了输出是自然顺序（0,1,2...），输入序列 $x(n)$ 需要进行**码位倒置**（Bit-Reversal）。
    *   例如 $N=8$：
        *   自然序：0(000), 1(001), 2(010), 3(011)...
        *   倒位序：0(000), 4(100), 2(010), 6(110)...
3.  **蝶形距离**：第 $m$ 级（$m=1\dots M$）的蝶形运算，输入节点间距为 $2^{m-1}$。
4.  **旋转因子**：第 $m$ 级拥有 $2^{m-1}$ 种不同的旋转因子 $W_N^p$。

---

### **4. 按频率抽取 FFT (DIF-FFT)**

**核心思想**：不把输入分奇偶，而是把输入序列分为**前半部分**和**后半部分**。

#### **4.1 算法推导简述**
$$ X(k) = \sum_{n=0}^{N/2-1} x(n)W_N^{nk} + \sum_{n=N/2}^{N-1} x(n)W_N^{nk} $$
经过推导，可以将输出分为两组：
*   **偶数项输出** $X(2r)$：对应 $[x(n) + x(n+N/2)]$ 的 $N/2$ 点DFT。
*   **奇数项输出** $X(2r+1)$：对应 $[(x(n) - x(n+N/2))W_N^n]$ 的 $N/2$ 点DFT。

#### **4.2 蝶形运算 (DIF)**
与DIT略有不同（乘法位置不同）：
$$
\begin{cases}
A &= x(n) + x(n+N/2) \\
B &= (x(n) - x(n+N/2)) W_N^n
\end{cases}
$$

#### **4.3 规律**
*   **输入自然序，输出倒位序**。
*   其余复杂度与DIT完全相同。

---

### **5. 算法特性总结（必考点）**

#### **5.1 运算量**
*   **复数乘法**：$\frac{N}{2} \log_2 N$
*   **复数加法**：$N \log_2 N$
*   与直接DFT相比，效率提升比约为 $\frac{N^2}{N \log_2 N/2} = \frac{2N}{\log_2 N}$。$N$越大，优势越极其明显。

#### **5.2 原位运算 (In-place Computation)**
观察蝶形图发现，第 $m$ 级的输出 $X_{m}(k)$ 和 $X_{m}(k+B)$ 仅仅取决于第 $m-1$ 级的输入 $X_{m-1}(k)$ 和 $X_{m-1}(k+B)$。
*   **结论**：我们可以直接用输出值覆盖输入值的存储单元。
*   **优点**：不需要额外的存储空间（除了几个寄存器），这对早期的硬件非常宝贵。

#### **5.3 IDFT 的 FFT 实现**
$$ x(n) = \frac{1}{N} \sum_{k=0}^{N-1} X(k) W_N^{-nk} $$
IDFT与DFT公式几乎一样，区别仅在于：
1.  旋转因子指数是正的（或理解为 $W_N^{-nk} = (W_N^{nk})^*$）。
2.  最后多乘一个 $1/N$。
*   **实现方法**：可以直接调用FFT子程序。
    *   方法：将输入 $X(k)$ 取共轭 $\to$ 做FFT $\to$ 结果取共轭 $\to$ 除以 $N$。

---

## **三、 典型习题与易错点分析**

### **例题1：蝶形运算计算**
已知 DIT-FFT 某一级蝶形运算的输入为 $A=3+j2, B=1-j4$，旋转因子 $W_8^2 = -j$。求输出。
**解**：
*   $W_8^2 \cdot B = (-j) \cdot (1-j4) = -j - 4 = -4-j$。
*   上支路输出：$A + W \cdot B = (3+j2) + (-4-j) = -1 + j$。
*   下支路输出：$A - W \cdot B = (3+j2) - (-4-j) = 7 + j3$。
*   *易错点*：下支路是减法，别忘了变号。

### **例题2：码位倒置**
求 $N=8$ 时，自然序数 $n=3$ 对应的倒位序数是多少？
**解**：
1.  $N=8 \to 3$ 位二进制。
2.  $n=3 \to 011_2$。
3.  倒置 $\to 110_2$。
4.  转十进制 $\to 6$。

### **例题3：运算量对比**
计算 4096 点的DFT，FFT比直接DFT快多少倍？
**解**：
*   $N = 4096 = 2^{12}$。
*   DFT复乘次数：$N^2$。
*   FFT复乘次数：$(N/2) \log_2 N = 2048 \times 12$。
*   比值：$\frac{N^2}{(N/2)\log_2 N} = \frac{2N}{\log_2 N} = \frac{2 \times 4096}{12} \approx 682$ 倍。

---

## **四、 第6讲小结**

1.  **核心思想**：利用 $W_N$ 的对称性和周期性，将长序列分解为短序列。
2.  **DIT-FFT 流程**：
    *   **倒位序输入**。
    *   **三层循环**：级数 $m$ (1 to M) $\to$ 蝶形组 $j$ $\to$ 蝶形计算。
    *   **自然序输出**。
3.  **蝶形公式**（DIT）：
    $$
    \begin{cases} A' = A + W \cdot B \\ B' = A - W \cdot B \end{cases}
    $$

## **五、 课后思考（为下一讲铺垫）**
*   我们已经掌握了FFT算法，计算频谱变得非常快。
*   那么，**FFT计算出来的频谱（DFT结果）到底准不准？** 它和真实的连续信号频谱有什么关系？
*   如果参数选不好，会出现什么问题（栅栏效应、频谱泄漏）？
*   这就是下一讲的内容：**DFT/FFT 的应用与参数选择**。

---
好的，我们现在进行**第7讲：DFT/FFT的应用**。

在前几讲中，我们建立了DFT的理论体系并掌握了FFT快速算法。现在的你，手里已经握有了“屠龙刀”（FFT）。这一讲，我们要学习**如何使用这把刀**。

DFT/FFT在工程中主要有两大应用领域：
1.  **信号分析**：用来看信号的频谱（谱分析）。
2.  **信号处理**：用来计算线性卷积（快速滤波）。

这一讲将重点解决**“理论与现实的差距”**——为什么FFT算出来的谱有时候看起来是错的？（泄漏、栅栏效应等）以及如何修正。

---

# **第7讲：DFT/FFT的应用**

## **一、 学习目标**
1.  **掌握** 利用DFT对连续信号进行频谱分析的全流程及参数选择（$f_s, N, T_p$）。
2.  **深刻理解** 频谱分析中的三大误差来源：**混叠**、**频谱泄漏**、**栅栏效应**，并掌握相应的抑制方法。
3.  **辨析** “补零”的作用：它能提高物理分辨率吗？（这是一个常考的易错点）。
4.  **掌握** 窗函数（Windowing）的作用及常用窗函数的特性权衡。
5.  **熟练掌握** 长序列卷积的FFT算法：**重叠相加法**与**重叠保留法**。

---

## **二、 核心内容精讲**

### **1. 利用DFT进行连续信号的频谱分析**

现实中的信号是模拟的（连续的），而DFT是离散的。要用DFT分析模拟信号，需要经过以下步骤：

1.  **预处理**：抗混叠滤波（低通）。
2.  **采样**：将 $x_a(t)$ 变为 $x(n)$，采样率 $f_s$。
3.  **截断**：信号往往无限长，必须截取一段长度为 $T_p$ 的数据，对应点数 $N$。
4.  **DFT/FFT**：计算 $N$ 点DFT。
5.  **对应频率轴**：将 $k$ 映射回模拟频率 $f$。

#### **1.1 参数关系（必背）**
*   **模拟频率分辨率 (Frequency Resolution)**：
    $$ f_0 = \frac{f_s}{N} = \frac{1}{NT} = \frac{1}{T_p} $$
    *   即：**频率分辨率由信号的观测时长 $T_p$ 决定**。观测时间越长，分辨率越高（$f_0$越小）。
*   **第 $k$ 条谱线对应的模拟频率**：
    $$ f_k = k \cdot \frac{f_s}{N} $$

---

### **2. 频谱分析中的误差与对策**

在使用FFT时，经常会出现计算结果与理论频谱不符的情况，主要原因有以下三点：

#### **2.1 混叠现象 (Aliasing)**
*   **原因**：采样率不足，不满足奈奎斯特采样定理 ($f_s < 2f_{max}$)。
*   **表现**：高频分量折叠到低频，导致频谱混乱。
*   **对策**：
    1.  提高采样率 $f_s$。
    2.  在采样前加装**抗混叠滤波器**（模拟低通滤波器）。

#### **2.2 频谱泄漏 (Spectral Leakage)**
这是实际应用中最常见的问题。
*   **现象**：原本单一频率的正弦波（应该是冲击谱线），在FFT结果中变成了一个**主瓣很宽、旁边有许多旁瓣**的形状。能量从中心频率“漏”到了其他频率上。
*   **根本原因**：**截断**。
    *   对信号截断 $\Leftrightarrow$ 时域乘以矩形窗 $R_N(n)$。
    *   时域相乘 $\Leftrightarrow$ **频域卷积**。
    *   原信号频谱（冲激）与矩形窗频谱（Sinc函数形状）卷积 $\Rightarrow$ 结果变成了Sinc函数的形状。
*   **特例（整周期截取）**：如果截取的长度 $T_p$ 恰好是信号周期的整数倍，那么DFT的采样点正好落在Sinc函数的零点上，此时看起来没有泄漏。但对于随机信号或多频率信号，这几乎不可能做到。
*   **对策**：
    1.  **加窗 (Windowing)**：使用旁瓣更低、衰减更快的非矩形窗（如汉宁窗、汉明窗）。
    2.  增加截取长度 $N$（使主瓣变窄，但不能消除旁瓣）。

#### **2.3 栅栏效应 (Picket Fence Effect)**
*   **现象**：真实的频谱峰值可能位于两个离散频率点 $k$ 和 $k+1$ 之间。由于DFT只能看到离散点，就像透过栅栏看风景，可能会漏掉中间的峰值。
*   **对策**：**补零 (Zero Padding)**。
    *   在数据末尾补0，使 $N$ 变大。
    *   **效果**：时域补零 $\Leftrightarrow$ **频域内插**。这会使谱线更密集，显示的曲线更光滑，从而减少漏掉峰值的可能性。

---

### **3. 窗函数 (Window Function)**

为了抑制频谱泄漏，我们用其他窗函数代替矩形窗。

#### **3.1 常用窗函数特性**
| 窗函数 | 主瓣宽度 (近似) | 旁瓣峰值 (衰减) | 特点 |
| :--- | :--- | :--- | :--- |
| **矩形窗** | $4\pi/N$ | -13 dB | 分辨率最高，但泄漏最严重 |
| **汉宁窗 (Hanning)** | $8\pi/N$ | -31 dB | 旁瓣衰减大，主瓣加宽 |
| **汉明窗 (Hamming)** | $8\pi/N$ | -41 dB | 旁瓣衰减更大，常用 |
| **布莱克曼窗** | $12\pi/N$ | -57 dB | 泄漏最小，但主瓣最宽（分辨率最低） |

#### **3.2 权衡原则 (Trade-off)**
*   **主瓣宽度**决定了**频率分辨力**（能不能分开两个靠得很近的频率）。
*   **旁瓣衰减**决定了**幅度分辨力**（能不能在强信号旁边检测到弱信号）。
*   **结论**：没有完美的窗。要分辨率高就选矩形窗；要抑制泄漏（检测弱信号）就选Blackman窗。

---

### **4. 补零的迷思（核心辨析）**

**问：补零能提高频率分辨率吗？**
*   **答：不能（物理分辨率）**，但**能（计算分辨率/视觉分辨率）**。
*   **解释**：
    *   真正的**物理分辨率**由数据的**观测时长 $T_p$** 决定（$f_0 = 1/T_p$）。如果两个频率靠得很近，只补零而不增加观测时长，这两个峰在频谱上依然是一个融合的大包，分不开。
    *   补零只是在现有的频谱形状上进行**内插**（加密采样点），让你看得更清楚（减小栅栏效应），但不会创造出新的信息。

---

### **5. 快速卷积 (Fast Convolution)**

利用FFT计算LTI系统的线性卷积，比直接时域卷积快得多。

#### **5.1 基础原理**
$$ y(n) = x(n) * h(n) = \text{IDFT}[ \text{DFT}(x) \cdot \text{DFT}(h) ] $$
*   **关键点**：DFT计算的是**圆周卷积**。要让圆周卷积等于线性卷积，必须**补零**。
*   若 $x(n)$ 长 $N$， $h(n)$ 长 $M$，则FFT的点数 $L$ 必须满足：
    $$ L \ge N + M - 1 $$
    通常取 $L$ 为 $2$ 的整数次幂。

#### **5.2 长序列卷积（分段卷积）**
当输入 $x(n)$ 很长（如音频流），无法一次性做FFT时，需分段处理。
设 $h(n)$ 长度为 $M$，分段长度为 $N$。

1.  **重叠相加法 (Overlap-Add)**
    *   **切分**：将 $x(n)$ 切成长度为 $N$ 的不重叠小段。
    *   **补零**：每段末尾补 $M-1$ 个零，使其长度达到 $L = N+M-1$。
    *   **卷积**：对每段做FFT卷积，得到长为 $L$ 的输出。
    *   **叠加**：输出段之间有 $M-1$ 个点是重叠的，需要**相加**。

2.  **重叠保留法 (Overlap-Save)**
    *   **切分**：每段取 $L$ 点，但每段的开头要**重复**上一段的最后 $M-1$ 个点。
    *   **卷积**：直接做 $L$ 点圆周卷积。
    *   **舍弃**：由于圆周卷积的混叠效应，每段输出的前 $M-1$ 点是错误的（混叠点），需要**舍弃**，只保留后面 $N$ 个点。
    *   **拼接**：将保留的部分直接拼接。

---

## **三、 典型例题解析**

### **例题1：参数选择**
要分析一个带宽为 100Hz 的信号，要求频率分辨率优于 0.5Hz。求最小记录时间 $T_p$ 和最少采样点数 $N$。
**解**：
1.  **采样率**：根据采样定理，最低 $f_s = 2 \times 100 = 200 \text{Hz}$。
2.  **分辨率**：$f_0 = \frac{1}{T_p} \le 0.5 \text{Hz} \implies T_p \ge 2 \text{s}$。
3.  **点数**：$N = T_p \times f_s = 2 \times 200 = 400$ 点。
    *   *实际FFT中通常取 $N=512$。*

### **例题2：补零与分辨力**
有两个频率分别为 $f_1=10\text{Hz}, f_2=10.2\text{Hz}$ 的正弦波合成信号。采样率 $f_s=100\text{Hz}$。
*   情况A：截取 $N=100$ 点数据，补零到 $N'=1000$ 点做FFT。能分辨吗？
    *   **分析**：数据时长 $T_p = N/f_s = 1\text{s}$。物理分辨率 $1/T_p = 1\text{Hz}$。
    *   由于 $|f_1 - f_2| = 0.2 < 1$，所以**不能分辨**。补零再多也只是得到一个平滑的单峰。
*   情况B：截取 $N=1000$ 点数据，不做补零。能分辨吗？
    *   **分析**：数据时长 $T_p = 10\text{s}$。物理分辨率 $0.1\text{Hz}$。
    *   $0.2 > 0.1$，所以**能分辨**。

### **例题3：线性卷积的FFT实现**
$x(n)=\{1, 2, 3\}$, $h(n)=\{1, 1\}$。
1.  线性卷积长度是多少？
2.  若用FFT计算，至少需要几点FFT？
3.  若用4点DFT计算圆周卷积，结果是什么？是否等于线性卷积？

**解**：
1.  长度 $L = 3 + 2 - 1 = 4$。
2.  FFT点数 $N \ge 4$。
3.  **4点圆周卷积**：
    *   $x(n)$ 补零: $\{1, 2, 3, 0\}$
    *   $h(n)$ 补零: $\{1, 1, 0, 0\}$
    *   计算结果等于线性卷积：$\{1, 3, 5, 3\}$。
    *   *注*：如果是3点DFT，就会发生混叠，$y_C(0) = y_L(0) + y_L(3) = 1+3=4$，结果为 $\{4, 3, 5\}$，这就错了。

---

## **四、 第7讲小结**

1.  **误差来源**：
    *   混叠 $\leftarrow$ 采样率不够。
    *   泄漏 $\leftarrow$ 截断（加矩形窗）。
    *   栅栏 $\leftarrow$ 频域离散采样。
2.  **解决之道**：
    *   抗混叠滤波、提高采样率。
    *   加柔和的窗（汉宁/汉明）。
    *   补零（改善显示，不提高物理分辨率）。
3.  **快速卷积**：
    *   必须满足 $L \ge N+M-1$。
    *   分段卷积（重叠相加/保留）是处理无限长信号的标准方法。

## **五、 课后思考（为下一讲铺垫）**
*   到目前为止，我们已经掌握了如何分析信号。接下来，我们要学习如何**改变信号**——即**数字滤波器设计**。
*   如何设计一个系统 $H(z)$，让它只通过低频，阻断高频？
*   模拟滤波器我们很熟悉（巴特沃斯、切比雪夫），能不能把模拟滤波器变成数字的？
*   **预告**：下一讲我们将进入第四模块——**IIR数字滤波器设计**。

---
好的，我们现在进入**第四模块：数字滤波器设计**。这是数字信号处理中最具工程应用价值的部分。

**第8讲：IIR滤波器设计（基于模拟原型）**

在之前的课程中，我们已经掌握了分析离散系统的工具（Z变换、频响）。从现在开始，我们要扮演“架构师”的角色：**给定一个滤波需求（比如滤除50Hz工频干扰），如何设计出系统函数 $H(z)$？**

IIR（无限长单位脉冲响应）滤波器的设计通常采用“借力打力”的策略——**借助成熟的模拟滤波器设计理论，将其映射到数字域**。

---

# **第8讲：IIR滤波器设计（基于模拟原型）**

## **一、 学习目标**
1.  **理解** IIR滤波器设计的总体思路（模拟 $\to$ 数字）。
2.  **掌握** **脉冲响应不变法**的原理、变换公式及**混叠效应**的成因。
3.  **精通** **双线性变换法**的原理、变换公式、**频率畸变**现象及**预畸变**校正方法。
4.  **能够** 独立完成巴特沃斯（Butterworth）数字低通滤波器的设计计算。

---

## **二、 核心内容精讲**

### **1. IIR滤波器设计概述**

#### **1.1 什么是IIR滤波器？**
*   **定义**：单位脉冲响应 $h(n)$ 是无限长的。
*   **结构特点**：系统函数 $H(z)$ 具有反馈环路（分母多项式不为常数），存在非零极点。
    $$ H(z) = \frac{\sum b_k z^{-k}}{1 - \sum a_k z^{-k}} $$
*   **优势**：利用模拟滤波器的成熟理论，可以用较低的阶数获得很好的选频特性（效率高）。

#### **1.2 为什么基于模拟原型设计？**
模拟滤波器（如巴特沃斯、切比雪夫、椭圆滤波器）的理论已经非常完备，有现成的公式和图表。
**设计路线图**：
1.  **指标转换**：将数字滤波器的指标（$\omega_p, \omega_s, \dots$）转换为模拟滤波器的指标（$\Omega_p, \Omega_s, \dots$）。
2.  **模拟设计**：设计一个模拟滤波器 $H_a(s)$。
3.  **离散化**：将 $H_a(s)$ 映射为数字滤波器 $H(z)$。

**关键难点**：如何建立 $s$ 平面到 $z$ 平面的映射，使得：
*   **因果稳定**：$s$ 左半平面 $\to$ $z$ 单位圆内。
*   **频响模仿**：$s$ 虚轴 ($j\Omega$) $\to$ $z$ 单位圆 ($e^{j\omega}$)。

---

### **2. 方法一：脉冲响应不变法 (Impulse Invariance Method)**

#### **2.1 基本思想**
顾名思义，让数字滤波器的单位脉冲响应 $h(n)$ 等于模拟滤波器单位冲激响应 $h_a(t)$ 的**等间隔采样值**。
$$ h(n) = h_a(nT) \quad n=0, 1, 2, \dots $$
其中 $T$ 为采样周期。

#### **2.2 变换公式（从 $s$ 到 $z$）**
利用Z变换和拉普拉斯变换的关系：
设模拟系统只有单阶极点（部分分式展开）：
$$ H_a(s) = \sum_{k=1}^{N} \frac{A_k}{s - p_k} $$
对应时域：
$$ h_a(t) = \sum_{k=1}^{N} A_k e^{p_k t} u(t) $$
进行采样 $t=nT$：
$$ h(n) = h_a(nT) = \sum_{k=1}^{N} A_k (e^{p_k T})^n u(n) $$
对 $h(n)$ 求Z变换：
$$ H(z) = \sum_{n=0}^{\infty} h(n) z^{-n} = \sum_{k=1}^{N} \frac{A_k}{1 - e^{p_k T} z^{-1}} $$

**核心结论（必背）**：
$$ \frac{1}{s - p_k} \quad \xrightarrow{\text{映射}} \quad \frac{1}{1 - e^{p_k T} z^{-1}} $$
即：$s$ 平面的极点 $p_k$ 映射为 $z$ 平面的极点 $e^{p_k T}$。

#### **2.3 频率关系与混叠效应（致命缺陷）**
*   **频率映射**：$\omega = \Omega T$。这是线性的频率关系。
*   **问题**：这本质上就是**时域采样**。根据第4讲的采样定理，采样会导致频域的**周期延拓**。
    $$ H(e^{j\omega}) = \frac{1}{T} \sum_{k=-\infty}^{\infty} H_a\left( j \frac{\omega - 2\pi k}{T} \right) $$
*   **后果**：如果模拟滤波器 $H_a(j\Omega)$ 不是严格带限的（高频不为0），延拓后会发生**频谱混叠 (Aliasing)**。

#### **2.4 适用范围**
*   **优点**：频率坐标是线性的，相位特性保持较好。
*   **缺点**：存在混叠，高频响应会变得很差。
*   **结论**：**只适用于低通、带通滤波器设计**（高频衰减快）。**绝对不能用于高通、带阻滤波器设计**。

---

### **3. 方法二：双线性变换法 (Bilinear Transformation)**

为了解决脉冲响应不变法的“混叠”问题，我们引入一种非线性的映射方法，将整个 $s$ 平面的虚轴压缩到 $z$ 平面的单位圆上。

#### **3.1 变换公式**
利用梯形积分公式近似微分方程，得到 $s$ 与 $z$ 的代数关系：
$$ s = \frac{2}{T} \frac{1 - z^{-1}}{1 + z^{-1}} $$
或者反过来：
$$ z = \frac{1 + \frac{T}{2}s}{1 - \frac{T}{2}s} $$

#### **3.2 映射特性**
*   $s$ 左半平面 ($\text{Re}[s]<0$) $\to$ $|z|<1$ (稳定保持)。
*   $s$ 虚轴 ($s=j\Omega$) $\to$ $|z|=1$ (频率响应对应)。
*   **一一映射**：整个 $j\Omega$ 轴 $(-\infty, +\infty)$ 被唯一地映射到了单位圆 $(-\pi, \pi)$ 上，**彻底消除了混叠**。

#### **3.3 频率畸变 (Frequency Warping)**
将 $s=j\Omega$ 和 $z=e^{j\omega}$ 代入变换公式：
$$ j\Omega = \frac{2}{T} \frac{1 - e^{-j\omega}}{1 + e^{-j\omega}} = \frac{2}{T} \frac{2j\sin(\omega/2)}{2\cos(\omega/2)} = j \frac{2}{T} \tan\left(\frac{\omega}{2}\right) $$
得到模拟频率 $\Omega$ 与数字频率 $\omega$ 的非线性关系：
$$ \Omega = \frac{2}{T} \tan\left(\frac{\omega}{2}\right) $$
或者：
$$ \omega = 2 \arctan\left(\frac{\Omega T}{2}\right) $$

*   **现象**：低频段 ($\omega \approx 0$) 近似线性，高频段 ($\omega \to \pi$) 被严重压缩。这种非线性映射被称为**频率畸变**。

#### **3.4 预畸变 (Pre-warping) —— 解决方案**
既然我们知道频率会发生畸变，那么在设计模拟滤波器之前，先把设计指标中的数字频率 $\omega$ “反向畸变”成模拟频率 $\Omega$。
**步骤**：
1.  给定数字指标 $\omega_p, \omega_s$。
2.  **预畸变**：计算对应的模拟指标 $\Omega_p = \frac{2}{T} \tan(\frac{\omega_p}{2})$。
3.  设计模拟滤波器 $H_a(s)$。
4.  代入双线性变换公式，得到 $H(z)$。这时，$\Omega_p$ 会被正好映射回 $\omega_p$。

---

### **4. 模拟低通滤波器原型（巴特沃斯）**

在考试和工程中，最常用的是**巴特沃斯 (Butterworth)** 滤波器。
*   **特点**：通带内最大平坦（无纹波），单调下降。
*   **幅度平方函数**：
    $$ |H_a(j\Omega)|^2 = \frac{1}{1 + (\frac{\Omega}{\Omega_c})^{2N}} $$
    *   $N$：阶数。
    *   $\Omega_c$：3dB截止频率。

*   **设计步骤**：
    1.  根据通带衰减 $\alpha_p$ 和阻带衰减 $\alpha_s$，计算阶数 $N$ 和截止频率 $\Omega_c$。
    2.  查表或计算极点，得到 $H_a(s)$。

---

### **5. 设计步骤总结（实战流程）**

#### **场景：设计一个IIR数字低通滤波器**
**给定指标**：通带截止频率 $\omega_p$，阻带截止频率 $\omega_s$，通带最大衰减 $\alpha_p$，阻带最小衰减 $\alpha_s$。

**路径一：脉冲响应不变法**
1.  换算模拟频率：$\Omega_p = \omega_p / T, \quad \Omega_s = \omega_s / T$。（$T$可任取，通常取1）。
2.  设计模拟滤波器 $H_a(s)$。
3.  将 $H_a(s)$ 展开为部分分式 $\sum \frac{A_k}{s-p_k}$。
4.  变换：$H(z) = \sum \frac{A_k}{1 - e^{p_k T} z^{-1}}$。

**路径二：双线性变换法（推荐）**
1.  **预畸变**：$\Omega_p = \frac{2}{T} \tan(\frac{\omega_p}{2}), \quad \Omega_s = \frac{2}{T} \tan(\frac{\omega_s}{2})$。
2.  设计模拟滤波器 $H_a(s)$。
3.  代换：将 $H_a(s)$ 中的 $s$ 替换为 $\frac{2}{T} \frac{1-z^{-1}}{1+z^{-1}}$。
4.  化简整理得到 $H(z)$。

---

## **三、 典型例题解析**

### **例题1：双线性变换法设计**
设计一个一阶低通数字滤波器，要求 $-3\text{dB}$ 截止频率为 $\omega_c = 0.2\pi$。使用双线性变换法。取 $T=2$。
**解**：
1.  **预畸变**：
    $$ \Omega_c = \frac{2}{T} \tan\left(\frac{\omega_c}{2}\right) = \tan(0.1\pi) \approx 0.325 $$
2.  **设计模拟原型**：
    一阶巴特沃斯滤波器归一化系统函数为 $H(s) = \frac{1}{s+1}$。
    去归一化（将 $s$ 换成 $s/\Omega_c$）：
    $$ H_a(s) = \frac{\Omega_c}{s + \Omega_c} = \frac{0.325}{s + 0.325} $$
3.  **双线性变换**：
    代入 $s = \frac{1-z^{-1}}{1+z^{-1}}$ （因为$T=2$，$\frac{2}{T}=1$）：
    $$ H(z) = \frac{0.325}{\frac{1-z^{-1}}{1+z^{-1}} + 0.325} $$
4.  **化简**：
    $$ H(z) = \frac{0.325(1+z^{-1})}{1 - z^{-1} + 0.325 + 0.325z^{-1}} = \frac{0.325(1+z^{-1})}{1.325 - 0.675z^{-1}} $$
    归一化分母常数项：
    $$ H(z) = \frac{0.245(1+z^{-1})}{1 - 0.509z^{-1}} $$

### **例题2：方法比较**
为什么高通滤波器不能用脉冲响应不变法设计？
*   **答**：脉冲响应不变法本质是采样。模拟高通滤波器的频响在高频处不为0（延伸至无穷大）。采样会导致严重的高频混叠，将高频分量折叠回低频，彻底破坏高通特性（可能变成带通甚至全通）。而双线性变换法将 $\Omega=\infty$ 映射到 $z=-1$（$\omega=\pi$），无混叠，适合各种滤波器。

---

## **四、 第8讲小结**

1.  **脉冲响应不变法**：
    *   **映射**：$z = e^{sT}$（线性频率关系 $\omega = \Omega T$）。
    *   **缺点**：**混叠**。
    *   **适用**：仅限低通、带通。

2.  **双线性变换法**：
    *   **映射**：$s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$ （非线性频率关系 $\Omega = \frac{2}{T}\tan\frac{\omega}{2}$）。
    *   **优点**：**无混叠**。
    *   **代价**：频率畸变（必须用**预畸变**解决）。
    *   **适用**：所有类型滤波器。

## **五、 课后思考（为下一讲铺垫）**
*   IIR滤波器虽然设计简单（利用模拟原型），但它的相位是非线性的。在通信和图像处理中，非线性相位会导致波形失真。
*   有没有一种滤波器，既能滤波，又能保证严格的**线性相位**？
*   这就是下一讲的主角——**FIR滤波器**。它不仅稳定，还能轻松实现线性相位，但代价是什么呢？（阶数通常很高）。

---
好的，我们进入**第9讲：FIR滤波器特性与窗函数设计法**。

如果说IIR滤波器是“借力打力”（利用模拟原型），那么FIR滤波器则是“自力更生”——直接在时域或频域构建我们想要的特性。FIR滤波器最大的杀手锏是**严格的线性相位**，这在通信、图像处理等对波形保真度要求高的领域至关重要。

---

# **第9讲：FIR滤波器特性与窗函数设计法**

## **一、 学习目标**
1.  **深刻理解** 线性相位的物理意义及其对系统单位脉冲响应 $h(n)$ 的约束条件（对称性）。
2.  **掌握** 四种线性相位FIR滤波器的幅度特性及其适用范围（**考点**）。
3.  **理解** 窗函数设计法的基本原理：时域截断 $\leftrightarrow$ 频域卷积。
4.  **辨析** 吉布斯效应（Gibbs Phenomenon）的成因及特点。
5.  **熟记** 常用窗函数（矩形、汉宁、汉明、布莱克曼）的性能指标与权衡规律。
6.  **能够** 按照给定的技术指标设计FIR滤波器。

---

## **二、 核心内容精讲**

### **1. 线性相位FIR滤波器的特性**

#### **1.1 为什么要线性相位？**
*   **相位失真**：如果系统对不同频率分量的延迟时间不同，合成后的输出波形就会发生畸变（如方波经过非线性相位系统后可能变成尖峰波）。
*   **线性相位**：$\phi(\omega) = -\alpha \omega + \beta$。
*   **群时延**：$\tau_g(\omega) = -\frac{d\phi(\omega)}{d\omega} = \alpha = \text{常数}$。这意味着所有频率分量经过系统后，都延迟了相同的时间 $\alpha$，波形形状保持不变（仅仅是整体平移）。
*   **FIR的优势**：IIR很难做到严格线性相位，而FIR很容易做到。

#### **1.2 线性相位的充分必要条件（核心）**
要使FIR滤波器具有线性相位，其单位脉冲响应 $h(n)$ 必须满足**对称性**。
设滤波器长度为 $N$（$n=0 \sim N-1$），对称中心为 $\alpha = \frac{N-1}{2}$。

*   **第一类线性相位（偶对称）**：
    $$ h(n) = h(N-1-n) $$
    *   此时 $\beta=0$，$\phi(\omega) = -\frac{N-1}{2}\omega$。
*   **第二类线性相位（奇对称）**：
    $$ h(n) = -h(N-1-n) $$
    *   此时 $\beta=\pi/2$，$\phi(\omega) = -\frac{N-1}{2}\omega + \frac{\pi}{2}$。

#### **1.3 四种类型的幅度特性与适用范围（必考难点）**
根据 $N$ 的奇偶性和 $h(n)$ 的对称性，FIR滤波器分为四种类型。不同类型在 $\omega=0$ 和 $\omega=\pi$ 处的特性决定了它们能设计成什么样的滤波器。

| 类型 | h(n)对称性 | 长度 N | 对称中心 | 约束特性 (零点位置) | 适用滤波器类型 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Type I** | 偶对称 | **奇数** | 整数 | 无强制零点 | **全能** (低通、高通、带通、带阻) |
| **Type II** | 偶对称 | **偶数** | 半整数 | $H(e^{j\pi})=0$ | 只能低通、带通 (**不能高通、带阻**) |
| **Type III**| 奇对称 | **奇数** | 整数 | $H(e^{j0})=0, H(e^{j\pi})=0$ | 只能带通 (**只能做微分器/希尔伯特变换**) |
| **Type IV** | 奇对称 | **偶数** | 半整数 | $H(e^{j0})=0$ | 只能高通、带通 (**不能低通**) |

*   **记忆技巧**：
    *   $N$为偶数时（Type II, IV），对称中心在两点中间，造成 $z=-1$ ($\omega=\pi$) 处或者是零点（偶对称），或者相位不是纯延时。
    *   奇对称（Type III, IV）导致直流 $\omega=0$ 处增益必为0（因为 $\sum h(n)=0$）。
    *   **结论**：设计低通滤波器，首选 **Type I** (偶对称，奇数长度)。

---

### **2. 窗函数设计法 (Window Method)**

这是最直观、最常用的FIR设计方法。

#### **2.1 设计思路**
1.  **理想化**：根据指标构造理想滤波器的频响 $H_d(e^{j\omega})$（通常是理想矩形）。
2.  **反变换**：求出理想单位脉冲响应 $h_d(n)$。
    *   例如理想低通：$h_d(n) = \frac{\sin[\omega_c(n-\alpha)]}{\pi(n-\alpha)}$，其中 $\alpha=\frac{N-1}{2}$。
    *   *注*：理想 $h_d(n)$ 是无限长且非因果的（双边延伸）。
3.  **加窗截断**：直接截取一段 $h_d(n)$，但这太粗暴，我们用一个有限长的窗函数 $w(n)$ 去乘 $h_d(n)$。
    $$ h(n) = h_d(n) \cdot w(n) $$
    $$ H(e^{j\omega}) = H_d(e^{j\omega}) * W(e^{j\omega}) \quad (\text{频域卷积}) $$

#### **2.2 吉布斯效应 (Gibbs Phenomenon)**
如果我们使用**矩形窗**（直接截断）：
*   频域上，矩形窗的频谱 $W(e^{j\omega})$ 是 Sinc 函数形状。
*   卷积结果导致理想滤波器的陡峭边缘变得平缓（**过渡带变宽**），且在通带和阻带边缘出现**波纹**。
*   **特性**：当 $N$ 增加时，波纹的**频率变密**，过渡带**变窄**，但波纹的**最大幅度**（约8.95%）**不随N增加而减小**。
*   这就是吉布斯效应。要减小波纹，必须换窗函数。

---

### **3. 常用窗函数及其特性**

窗函数的性能主要由两点决定：
1.  **主瓣宽度**：决定了滤波器的**过渡带宽度**（越窄越好）。
2.  **旁瓣衰减**：决定了滤波器的**阻带衰减**（越大越好）。
*   *矛盾*：通常旁瓣衰减越大，主瓣就越宽（不仅过渡带变宽，还需要更长的 $N$ 才能达到同样的陡峭度）。

#### **3.1 五大常用窗（熟记参数趋势）**

| 窗函数 | 旁瓣峰值 (dB) | 过渡带宽度 (近似) | 最小阻带衰减 (dB) | 特点 |
| :--- | :--- | :--- | :--- | :--- |
| **矩形窗** (Rectangular) | -13 | $4\pi/N$ | 21 | 过渡带最窄，但阻带衰减最差 |
| **汉宁窗** (Hanning) | -31 | $8\pi/N$ | 44 | 升余弦窗，旁瓣衰减显著改善 |
| **汉明窗** (Hamming) | **-41** | **$8\pi/N$** | **53** | **最常用**，改进的升余弦 |
| **布莱克曼窗** (Blackman)| -57 | $12\pi/N$ | 74 | 阻带衰减极好，但过渡带最宽 |
| **凯塞窗** (Kaiser) | 可调 | 可调 | 可调 | 最佳窗，通过参数 $\beta$ 调节 |

#### **3.2 凯塞窗 (Kaiser Window)**
工程中最优的窗函数。它利用贝塞尔函数构造，通过参数 $\beta$ 可以在主瓣宽度和旁瓣衰减之间自由权衡。
*   $\beta=0$ 时退化为矩形窗。
*   $\beta$ 越大，旁瓣越低，过渡带越宽。

---

### **4. FIR滤波器设计步骤 (实战)**

假设给定指标：通带截止 $\omega_p$，阻带截止 $\omega_s$，阻带最小衰减 $A_s$ (dB)。

1.  **计算过渡带宽度**：$\Delta \omega = |\omega_s - \omega_p|$。
2.  **选择窗函数**：根据阻带衰减 $A_s$ 查表选择合适的窗函数（例如 $A_s=50dB$，矩形窗(21)和汉宁窗(44)都不够，必须选**汉明窗**(53)或更高）。
3.  **估算滤波器长度 $N$**：
    利用公式：$\text{过渡带} \approx \frac{C \cdot 2\pi}{N}$ (C为窗的主瓣因子)。
    *   矩形窗：$N \approx 4\pi / \Delta \omega$
    *   汉明窗：$N \approx 8\pi / \Delta \omega$
    *   布莱克曼：$N \approx 12\pi / \Delta \omega$
    *   *注意：如果算出的N是偶数且设计的是低通(Type I)，通常加1变为奇数。*
4.  **计算理想脉冲响应 $h_d(n)$**：
    *   截止频率取中间值：$\omega_c = (\omega_p + \omega_s) / 2$。
    *   延迟中心：$\alpha = (N-1)/2$。
    *   $h_d(n) = \frac{\sin[\omega_c(n-\alpha)]}{\pi(n-\alpha)}$。
5.  **加窗**：$h(n) = h_d(n) \cdot w(n)$。

---

## **三、 典型例题解析**

### **例题1：线性相位判断**
判断下列系统是否具有线性相位？
1.  $H(z) = 1 + 2z^{-1} + 3z^{-2} + 2z^{-3} + z^{-4}$
    *   **分析**：系数为 $\{1, 2, 3, 2, 1\}$。关于中心偶对称。
    *   **结论**：是线性相位（Type I）。
2.  $H(z) = 1 + 2z^{-1} - 2z^{-3} - z^{-4}$
    *   **分析**：系数为 $\{1, 2, 0, -2, -1\}$。关于中心点（系数0）奇对称。
    *   **结论**：是线性相位（Type III）。

### **例题2：窗函数法设计**
设计一个FIR低通滤波器，$\omega_p=0.3\pi, \omega_s=0.4\pi, A_s \ge 50dB$。
**解**：
1.  **计算过渡带**：$\Delta \omega = 0.4\pi - 0.3\pi = 0.1\pi$。
2.  **选窗**：
    *   矩形窗(21dB) - 不行。
    *   汉宁窗(44dB) - 不行。
    *   汉明窗(53dB) - **可以**。
    *   布莱克曼窗(74dB) - 可以，但阶数会更高，浪费。
    *   **选择：汉明窗 (Hamming)**。
3.  **确定阶数 $N$**：
    汉明窗过渡带公式：$\Delta \omega = \frac{6.6\pi}{N}$ (或近似 $8\pi/N$ 保守估算)。
    $$ N \ge \frac{6.6\pi}{0.1\pi} = 66 $$
    为了保证是Type I（偶对称、奇数长），取 **$N=67$**。
4.  **构造 $h(n)$**：
    *   $\alpha = (67-1)/2 = 33$。
    *   $\omega_c = (0.3\pi + 0.4\pi)/2 = 0.35\pi$。
    *   $h(n) = \frac{\sin[0.35\pi(n-33)]}{\pi(n-33)} \cdot [0.54 - 0.46\cos(\frac{2\pi n}{66})], \quad 0 \le n \le 66$。

---

## **四、 第9讲小结**

1.  **线性相位**：是FIR最大的卖点。必须保证 $h(n)$ 对称。
    *   **Type I** (偶对称，奇长度) 最通用，尤其是低通。
    *   **Type II** (偶对称，偶长度) $\omega=\pi$ 必为0，不能做高通。
2.  **窗函数设计**：本质是权衡。
    *   **矩形窗**：过渡带窄，阻带差。
    *   **Blackman窗**：阻带好，过渡带宽。
    *   **Hamming窗**：性价比之王，工程最常用。
3.  **设计流程**：指标 $\to$ $\Delta \omega$ $\to$ 选窗 $\to$ 算 $N$ $\to$ 公式计算 $h(n)$。

## **五、 课后思考（为下一讲铺垫）**
*   我们现在已经学完了IIR（模拟原型法）和FIR（窗函数法）的设计。
*   如果给你一个实际工程任务，你是选择IIR还是FIR？依据是什么？
*   IIR阶数低但相位非线性，FIR相位线性但阶数高。有没有两全其美的办法？
*   下一讲，我们将进行**第10讲：IIR与FIR的比较与选择**，并总结系统设计部分。

---
好的，我们现在进行**第10讲：IIR与FIR的比较与选择**。

这一讲是**第四模块（系统设计）的总结篇**。在实际工程和考试中，我们往往不仅要会“怎么算”，更要懂得“怎么选”。作为一个信号处理工程师，面对一个具体的滤波任务，第一反应不应该是“套公式”，而是“选型”。

本讲将从理论特性、性能指标、硬件实现等多个维度，对IIR和FIR进行全方位的对比。

---

# **第10讲：IIR与FIR的比较与选择**

## **一、 学习目标**
1.  **系统性掌握** IIR与FIR在结构、相位特性、幅度特性、稳定性及运算量上的根本区别。
2.  **能够** 根据具体的应用场景（如图像处理、语音通讯、生物医学信号等），合理选择滤波器类型。
3.  **理解** 两种滤波器的优缺点背后的数学本质（极点与零点的作用）。

---

## **二、 核心内容精讲**

### **1. 结构与定义的本质区别**

| 特性 | **FIR (有限长单位脉冲响应)** | **IIR (无限长单位脉冲响应)** |
| :--- | :--- | :--- |
| **时域方程** | $y(n) = \sum_{k=0}^{N-1} h(k)x(n-k)$ | $y(n) = \sum_{k=0}^{M} b_k x(n-k) - \sum_{k=1}^{N} a_k y(n-k)$ |
| **结构类型** | **非递归** (Non-recursive)<br>无反馈回路 | **递归** (Recursive)<br>有反馈回路 (输出 $y$ 反馈回输入) |
| **Z域极点** | 全部位于原点 $z=0$ (仅有零点起作用) | 极点分布在 $z$ 平面的任意位置 |
| **冲激响应** | 有限长 ($N$点) | 无限长 (理论上永不衰减为0) |

---

### **2. 性能特性的深度对比（核心考点）**

#### **2.1 相位特性 (Phase Linearity) —— 最重要的区别**
*   **FIR**：**很容易实现严格的线性相位**。
    *   只要满足 $h(n)$ 对称（偶对称或奇对称），就具有线性相位。
    *   **物理意义**：所有频率成分通过滤波器后的延时时间是相同的（群延时为常数）。这对**波形保真**至关重要。
*   **IIR**：**很难实现线性相位**。
    *   IIR的相位是非线性的，特别是在截止频率附近，相位失真严重。
    *   虽然可以通过增加“全通滤波器”进行相位校正，但这会显著增加系统阶数和复杂度。

#### **2.2 幅频特性 (Magnitude Response)**
*   **IIR**：**效率高**。
    *   利用**极点**（Poles）靠近单位圆来产生陡峭的增益变化。
    *   用较低的阶数（例如 $N=4 \sim 8$）就能获得极好的过渡带特性和阻带衰减。
    *   *比喻*：极点像“支柱”，几根支柱就能撑起一个陡峭的帐篷。
*   **FIR**：**效率低**。
    *   仅靠**零点**（Zeros）来塑造频谱。
    *   为了获得陡峭的过渡带，需要很高的阶数（通常 $N > 30$，甚至上百）。
    *   *比喻*：没有支柱，只能靠无数个小钉子（零点）把地毯按出形状，需要很多钉子。

#### **2.3 稳定性 (Stability)**
*   **FIR**：**无条件稳定**。
    *   因为没有反馈回路，极点都在原点，永远在单位圆内。
*   **IIR**：**条件稳定**。
    *   极点必须设计在单位圆内。如果系数量化误差导致极点移出单位圆，系统将发散（震荡）。

---

### **3. 实现与误差分析**

#### **3.1 运算量与复杂度**
*   **阶数对比**：对于相同的幅频指标（如通带波纹、阻带衰减、过渡带宽度），**FIR的阶数通常是IIR的5到10倍**。
*   **乘法次数**：
    *   虽然FIR阶数高，但可以使用FFT实现**快速卷积**，在 $N$ 很大时，运算效率反而可能超过IIR。
    *   IIR只能逐点计算（硬算），无法利用FFT加速。

#### **3.2 量化误差与有限字长效应**
*   **IIR**：**敏感**。
    *   由于有反馈，误差会循环积累。
    *   容易出现**极限环振荡**（Limit Cycles）和**死区效应**。
    *   高阶IIR必须分解为二阶节（SOS）级联来实现，以降低系数量化敏感度。
*   **FIR**：**不敏感**。
    *   无反馈，误差不积累。
    *   不需要特殊的级联结构，直接卷积型实现即可。

---

### **4. 选择指南（工程直觉）**

在面对实际问题时，该如何选择？

#### **场景一：必须选择 FIR 的情况**
1.  **对相位要求极高**：
    *   **图像处理**：非线性相位会导致图像边缘模糊或产生重影。
    *   **数据传输/数字通信**：波形失真会导致误码率上升（码间串扰）。
    *   **生物医学信号**（如ECG心电图）：波形的特征点（P波、T波）位置不能移位。
2.  **需要多带滤波器**：
    *   FIR容易设计具有任意形状频响的滤波器（如多通带）。

#### **场景二：必须/优先选择 IIR 的情况**
1.  **对相位要求不高，但对幅频特性（选频）要求高**：
    *   **语音处理**：人耳对相位不敏感，但对频率成分很敏感。
    *   **噪声消除**：只需把特定频率滤除即可。
2.  **硬件资源受限（低成本、低功耗、低延迟）**：
    *   IIR阶数低，所需的存储器（RAM）少，乘法器少，计算延迟小。
    *   例如：在简单的单片机上滤除50Hz工频干扰（陷波器），IIR只需2阶，FIR可能需要几百阶。
3.  **模拟系统的数字化**：
    *   如果目的是模拟一个已有的模拟电路系统，IIR是天然的选择（脉冲响应不变法/双线性变换法）。

---

## **三、 总结对比表（考前速记）**

| 比较项目 | **IIR 滤波器** | **FIR 滤波器** |
| :--- | :--- | :--- |
| **相位特性** | 非线性 (缺点) | **严格线性** (最大优点) |
| **稳定性** | 可能不稳定 (极点跑偏) | **永远稳定** |
| **阶数 (相同指标)** | **低** (效率高) | 高 (通常高5-10倍) |
| **设计方法** | 借助模拟原型 (双线性变换) | 窗函数法、频率采样法 |
| **结构** | 递归 (有反馈) | 非递归 (无反馈) |
| **误差积累** | 严重 (极限环) | 轻微 (无积累) |
| **应用场景** | 语音、陷波、低成本控制 | 图像、通信、高保真音频 |

---

## **四、 典型例题解析**

### **例题1：选型判断**
**问题**：某医疗仪器需要对心电图（ECG）信号进行滤波，去除高频噪声，同时要求保留心电波形的时间特征（不发生相位畸变）。应选择哪种滤波器？
**解**：
*   关键词：“**保留波形时间特征**”、“**不发生相位畸变**”。
*   这要求滤波器具有**线性相位**特性。
*   **选择**：**FIR滤波器**。虽然IIR效率高，但其非线性相位会改变各频率分量的相对时间，导致心电图波形形状改变，影响医生诊断。

### **例题2：阶数估算**
**问题**：设计一个低通滤波器，通带截止1kHz，阻带截止1.2kHz，采样率10kHz，阻带衰减>50dB。
1.  若用IIR（椭圆滤波器），阶数大约是多少？
2.  若用FIR（凯塞窗），阶数大约是多少？
**解**：
*   这是一个过渡带很窄的滤波器（过渡带宽度 $\Delta f = 200\text{Hz}$，归一化 $\Delta \omega = 2\pi \frac{200}{10000} = 0.04\pi$）。
1.  **IIR**：由于有极点支撑，IIR可以用很低的阶数实现陡峭下降。对于椭圆滤波器，阶数可能仅需 **$N=4 \sim 6$** 阶。
2.  **FIR**：利用经验公式 $N \approx \frac{A_s - 8}{2.285 \Delta \omega}$。
    $N \approx \frac{50-8}{2.285 \times 0.04\pi} \approx \frac{42}{0.287} \approx 146$。
    *   **对比**：IIR只需几阶，FIR需要一百多阶。如果在资源受限的嵌入式设备上，IIR优势巨大。

---

## **五、 第四模块小结**

至此，我们完成了**系统设计**模块的学习。
*   **IIR** 走的是“模拟模仿”路线，由 $s$ 平面映射到 $z$ 平面，效率高但相位非线性。
*   **FIR** 走的是“时域截断/加窗”路线，直接构建 $h(n)$，相位线性但效率低。

**后续预告**：
设计好了滤波器（得到了 $H(z)$ 的系数 $a_k, b_k$ 或 $h(n)$），这只是纸面上的公式。
如何在计算机或DSP芯片里**实现**它？
*   是用直接型、级联型还是并联型？
*   计算机是有限字长的（比如16位），这会带来什么误差？

下一讲，我们将进入最后一个模块——**工程实现**，开始**第11讲：数字滤波器的结构**。

---
好的，我们现在进入**第五模块：系统的实现与误差分析**。

**第11讲：数字滤波器的结构**

在此之前，我们已经学会了如何“设计”滤波器，即求出了系统函数 $H(z)$ 的系数。但是，纸面上的 $H(z)$ 只是一个数学模型。要让它在计算机、DSP芯片或FPGA上工作，我们需要将数学公式转化为具体的**运算结构**（信号流图）。

**为什么同一个 $H(z)$ 需要不同的结构？**
虽然数学上等价，但在有限精度的硬件中，不同的结构对**系数精度的敏感度**、**运算速度**、**所需内存资源**以及**抗噪声能力**有着天壤之别。

---

# **第11讲：数字滤波器的结构**

## **一、 学习目标**
1.  **掌握** 离散时间系统的基本运算单元（加法、乘法、延时）。
2.  **精通** IIR滤波器的四种基本结构：**直接I型**、**直接II型（典范型）**、**级联型**、**并联型**。
3.  **精通** FIR滤波器的三种基本结构：**直接型（横截型）**、**级联型**、**线性相位结构**。
4.  **能够** 根据给定的差分方程或系统函数 $H(z)$，画出相应的信号流图。

---

## **二、 核心内容精讲**

### **1. 基本运算单元**

任何数字信号处理系统都是由以下三种基本元素构成的：

1.  **乘法器 (Multiplier)**：
    *   符号：箭头上的系数 $a$。
    *   功能：$y(n) = a \cdot x(n)$。
2.  **加法器 (Adder)**：
    *   符号：$\oplus$ 或 $\Sigma$。
    *   功能：$y(n) = x_1(n) + x_2(n)$。
3.  **单位延时器 (Unit Delay)**：
    *   符号：方框内的 $z^{-1}$。
    *   功能：$y(n) = x(n-1)$。
    *   **物理意义**：这就是硬件中的**寄存器**或**存储单元**。

---

### **2. IIR滤波器的结构**

IIR滤波器的特点是**有反馈**（递归结构），其系统函数为有理分式：
$$ H(z) = \frac{Y(z)}{X(z)} = \frac{\sum_{k=0}^{M} b_k z^{-k}}{1 - \sum_{k=1}^{N} a_k z^{-k}} $$
对应的差分方程：
$$ y(n) = \sum_{k=0}^{M} b_k x(n-k) + \sum_{k=1}^{N} a_k y(n-k) $$
*(注意：有的教材将分母写为 $1 + \sum a_k z^{-k}$，此时差分方程右边为减号，本质一样，注意符号即可。本讲义采用上述标准形式，即 $y(n)$ 是输入的加权和加上过去输出的加权和)*

#### **2.1 直接I型 (Direct Form I)**
**思路**：直接根据差分方程画图。将系统看作两个级联的部分：先是“零点部分”（只含 $x$），后是“极点部分”（只含 $y$）。

*   **结构**：
    *   左边是 $x(n)$ 的延时链（前馈）。
    *   右边是 $y(n)$ 的延时链（反馈）。
    *   中间通过加法器合成。
*   **缺点**：需要 $M+N$ 个延时器。对于一个 $N$ 阶系统，它用了 $2N$ 个存储单元，**效率低**，浪费资源。

#### **2.2 直接II型 / 典范型 (Direct Form II / Canonical Form) —— 必考重点**
**思路**：利用线性系统的交换律。
既然 $H(z) = H_1(z) \cdot H_2(z)$，我们可以交换顺序，先做反馈（极点），后做前馈（零点）。
$$ H(z) = \frac{1}{1 - \sum a_k z^{-k}} \cdot \left( \sum b_k z^{-k} \right) $$

*   **推导**：引入中间变量 $w(n)$。
    $$ W(z) = X(z) + \sum_{k=1}^{N} a_k z^{-k} W(z) $$
    $$ Y(z) = \sum_{k=0}^{M} b_k z^{-k} W(z) $$
*   **结构特点**：
    *   将两个延时链合并为中间的一条延时链。
    *   **优点**：对于 $N$ 阶系统，只需要 **$N$ 个延时器**。这是实现该传递函数所需的最少存储单元数，故称为**典范型**。
    *   **易错点**：画图时，左边系数是反馈系数 $a_k$（注意符号，通常移项后变号），右边是前馈系数 $b_k$。

#### **2.3 级联型 (Cascade Form) —— 工程首选**
**痛点**：高阶（如 $N>4$）的直接型结构对系数的**量化误差极度敏感**。微小的系数误差可能导致极点跑出单位圆，系统**不稳定**。

**思路**：将 $H(z)$ 分解为多个一阶或二阶子系统（二阶节, SOS）的乘积。
$$ H(z) = H_1(z) \cdot H_2(z) \cdot \dots \cdot H_k(z) $$
每个 $H_i(z)$ 通常是一个二阶节：
$$ H_i(z) = \frac{b_{0i} + b_{1i}z^{-1} + b_{2i}z^{-2}}{1 - a_{1i}z^{-1} - a_{2i}z^{-2}} $$

*   **优点**：
    1.  **稳定性好**：每个二阶节的极点独立控制，误差不扩散。
    2.  **调整方便**：可以独立调整某个零极点。

#### **2.4 并联型 (Parallel Form)**
**思路**：将 $H(z)$ 进行**部分分式展开**，表示为多个子系统的和。
$$ H(z) = C + H_1(z) + H_2(z) + \dots $$
*   **结构**：各子系统输入相同，输出相加。
*   **优点**：
    1.  **高速**：各子系统可以**并行计算**（多核处理器优势）。
    2.  **误差隔离**：一个子系统的误差不会影响其他子系统。

---

### **3. FIR滤波器的结构**

FIR系统的特点是**无反馈**，系统函数仅有分子：
$$ H(z) = \sum_{n=0}^{N-1} h(n) z^{-n} $$

#### **3.1 直接型 / 横截型 (Transversal Structure)**
**思路**：直接就是卷积和的图示。
$$ y(n) = h(0)x(n) + h(1)x(n-1) + \dots + h(N-1)x(n-N+1) $$
*   **结构**：一条延时链，每个节点引出乘法器，最后求和。
*   这就是最经典的“**卷积器**”结构。

#### **3.2 级联型**
将 $H(z)$ 分解为二阶因式的乘积。
*   在FIR中不如IIR常用，因为FIR本来就稳定，不需要为了稳定性去级联。主要用于需要控制零点位置的场合。

#### **3.3 线性相位结构 (Linear Phase Structure) —— 必考重点**
**前提**：FIR滤波器具有线性相位 $\iff$ $h(n)$ 偶对称或奇对称。
即 $h(n) = \pm h(N-1-n)$。

**思路**：利用系数的对称性，提取公因式，**减少乘法次数**。
例如 $N=4$ 的偶对称：$h(0)=h(3), h(1)=h(2)$。
$$ y(n) = h(0)[x(n)+x(n-3)] + h(1)[x(n-1)+x(n-2)] $$

*   **结构特点**：
    1.  将延时链的首尾信号先**相加**（或相减）。
    2.  然后再乘系数。
*   **优势**：**乘法器数量减少一半**（从 $N$ 减为 $N/2$）。
*   *注意*：这是FPGA/ASIC设计中节省硬件资源的经典技巧。

---

## **三、 典型例题解析**

### **例题1：画出直接II型结构**
已知系统函数为：
$$ H(z) = \frac{1 + 2z^{-1} + z^{-2}}{1 - 0.75z^{-1} + 0.125z^{-2}} $$
画出其典范型（直接II型）结构图。

**解题步骤**：
1.  **识别系数**：
    *   前馈系数（分子）：$b_0=1, b_1=2, b_2=1$。
    *   反馈系数（分母）：$a_1=0.75, a_2=-0.125$。（注意：差分方程移项后，结构图中的反馈增益符号与分母系数符号**相同**，如果是写成 $1 - \sum$，则图上系数为 $a_k$；如果分母是 $1 + \sum$，则图上系数为 $-a_k$。这里按照标准式 $y(n) = \sum a_k y(n-k)$，图上反馈支路系数即为 $0.75$ 和 $-0.125$）。
2.  **画中间轴**：画一条垂直的延时链，包含2个 $z^{-1}$。
3.  **画反馈（左侧）**：
    *   从第1个延时后引出，乘 $0.75$，加回到输入。
    *   从第2个延时后引出，乘 $-0.125$，加回到输入。
4.  **画前馈（右侧）**：
    *   从顶部（无延时）引出，乘 $1$。
    *   从第1个延时后引出，乘 $2$。
    *   从第2个延时后引出，乘 $1$。
    *   将右侧三路相加，输出 $y(n)$。

### **例题2：线性相位FIR结构**
设FIR滤波器单位脉冲响应为 $h(n) = \{1, -2, 3, 3, -2, 1\}$。画出最简结构图。

**分析**：
1.  长度 $N=6$。
2.  对称性：$h(0)=h(5)=1, h(1)=h(4)=-2, h(2)=h(3)=3$。满足偶对称。
3.  **画图逻辑**：
    *   画出5个延时单元的链条 $x(n) \dots x(n-5)$。
    *   将 $x(n)$ 与 $x(n-5)$ 相加，乘系数 $1$。
    *   将 $x(n-1)$ 与 $x(n-4)$ 相加，乘系数 $-2$。
    *   将 $x(n-2)$ 与 $x(n-3)$ 相加，乘系数 $3$。
    *   将这三路结果汇总。
4.  **节省**：原本需要6个乘法器，现在只需要3个。

---

## **四、 第11讲小结**

1.  **IIR结构**：
    *   **直接I型**：直观，但费存储（2N个延时）。
    *   **直接II型（典范型）**：**最省存储**（N个延时），教科书标准画法。
    *   **级联型**：**工程最常用**，稳定性好，系数敏感度低。
2.  **FIR结构**：
    *   **横截型**：就是卷积公式。
    *   **线性相位型**：利用对称性，**乘法量减半**。
3.  **画图要点**：
    *   分清前馈系数（$b_k$）和反馈系数（$a_k$）。
    *   IIR反馈回路的方向是**向上**的（加回到输入端）。

## **五、 课后思考（为下一讲铺垫）**
*   我们画的流图里，系数（如0.75, -0.125）在计算机里是无限精度的吗？
*   当然不是。计算机用有限的比特（如8位、16位）存储这些数。
*   这会带来什么后果？系数变了，极点位置会不会跑？乘法运算截断后的尾数去哪了？
*   **预告**：下一讲我们将探讨**有限字长效应（量化误差）**，看看数字系统的“数字化”带来的副作用。

---
好的，我们现在进行全课程的**最后一讲：第12讲 有限字长效应**。

在此之前，我们在纸面上推导公式、设计滤波器时，默认数值精度是无限的（Infinite Precision）。但在现实世界中，不论是DSP芯片、FPGA还是普通计算机，寄存器的位宽（Bit-width）都是有限的（如16位、32位）。

**“理想很丰满，现实很骨感”**。将无限精度的数学模型放入有限精度的硬件中，必然会产生误差。本讲就是要揭示这些误差的来源、后果以及应对策略。

---

# **第12讲：有限字长效应 (Finite Word Length Effects)**

## **一、 学习目标**
1.  **理解** 二进制数的表示方法（定点与浮点、原码与补码）及量化方式（截尾与舍入）。
2.  **掌握** 数字信号处理系统中的三大误差源：**A/D转换噪声**、**系数及化误差**、**运算舍入噪声**。
3.  **深刻理解** 系数量化对极点位置的影响（IIR的稳定性危机）。
4.  **掌握** 极限环振荡（Limit Cycles）的成因及消除溢出振荡的方法。

---

## **二、 核心内容精讲**

### **1. 数的表示与量化方式**

#### **1.1 二进制表示法**
在DSP硬件中，主要有两种数的表示格式：
1.  **定点制 (Fixed-Point)**：
    *   小数点位置固定（通常在最高位符号位之后）。
    *   特点：运算速度快，硬件简单，但动态范围小，容易溢出。
    *   *应用*：低成本微控制器、FPGA、定点DSP芯片。
2.  **浮点制 (Floating-Point)**：
    *   表示为 $N = M \cdot 2^E$（尾数+阶码）。
    *   特点：动态范围极大，精度高，但硬件复杂，功耗高。
    *   *应用*：高性能通用CPU、高级DSP芯片。

**补码 (Two's Complement)**：
这是负数最常用的表示法。
*   优点：加减法运算逻辑统一。
*   **溢出特性**：如果正溢出，会变成负数（回绕）；反之亦然。

#### **1.2 量化处理方式**
当一个高精度数（如乘法结果）要存入低精度寄存器时，必须去掉低位，这叫**量化**。
1.  **截尾 (Truncation)**：直接丢弃低位。
    *   误差：总是单向的（对于正数是负误差），有直流偏置。
2.  **舍入 (Rounding)**：四舍五入（看被丢弃的最高位是0还是1）。
    *   误差：分布在 $[-0.5\Delta, 0.5\Delta]$ 之间（$\Delta$为量化阶）。
    *   **优点**：误差均值为0（无偏），性能优于截尾。

---

### **2. 误差来源一：A/D转换噪声**

这是模拟信号进入数字系统时的第一道关卡。

*   **模型**：将A/D转换过程看作：`采样信号 + 量化噪声`。
    $$ x_q(n) = x(n) + e(n) $$
*   **信噪比 (SQNR)**：
    对于线性量化，量化比特数每增加1位，信噪比提高约6dB。
    $$ \text{SQNR (dB)} \approx 6.02b + 1.76 $$
    *   $b$：ADC的位数。
*   **结论**：这是系统的底噪，无法通过后续算法消除，只能换更好的ADC。

---

### **3. 误差来源二：系数的量化效应（核心考点）**

我们在设计滤波器时，计算出的系数 $a_k, b_k$ 往往是无限不循环小数。但存入寄存器时，必须量化成有限位数。
$$ H(z) = \frac{\sum b_k z^{-k}}{1 - \sum a_k z^{-k}} \quad \xrightarrow{\text{量化}} \quad H_q(z) = \frac{\sum \hat{b}_k z^{-k}}{1 - \sum \hat{a}_k z^{-k}} $$

#### **3.1 对极点位置的影响**
系数的变化 $\Delta a_k$ 会导致极点 $p_k$ 发生位移 $\Delta p_k$。
*   **IIR的风险**：IIR滤波器的极点位于单位圆内。如果极点原本就很靠近单位圆（窄带滤波器），系数量化可能导致**极点移出单位圆**。
    *   **后果**：系统变得**不稳定**。
*   **FIR的优势**：FIR的极点固定在原点 $z=0$，系数变化只改变零点位置，**永远保持稳定**。

#### **3.2 结构灵敏度**
*   **直接型结构**：对系数量化非常敏感。阶数越高，极点分布越密集，微小的系数扰动就会导致极点剧烈偏移。
    *   *结论*：**高阶IIR（N>4）绝对不能用直接型结构实现。**
*   **级联型/并联型**：将高阶分解为多个二阶节（SOS）。二阶节的系数只控制这一对极点，互不影响。
    *   *结论*：**工程中IIR滤波器几乎全部采用级联型结构实现。**

---

### **4. 误差来源三：运算过程中的舍入噪声**

这是指在数字滤波器内部，**乘法运算**后字长变长，必须再次量化回寄存器长度时产生的误差。

*   **噪声模型**：每个乘法器（或加法器后）都相当于插入了一个噪声源 $e(n)$。
*   **IIR vs FIR**：
    *   **FIR**：噪声只是简单地加权叠加传到输出端，没有反馈放大。
    *   **IIR**：由于存在反馈环路，内部产生的噪声会被反馈回路**反复循环、放大**。如果极点靠近单位圆，噪声增益会非常大（输出信噪比严重恶化）。

---

### **5. 极限环振荡 (Limit Cycles)**

这是IIR滤波器在有限字长下特有的非线性现象。
在理想线性系统中，若输入为0，输出最终应衰减为0。但在定点IIR系统中，输出可能会在某个非零范围内持续振荡。

#### **5.1 零输入极限环 (Granular Limit Cycle)**
*   **成因**：由于舍入/截尾操作的非线性特性，使得系统在原点附近存在一个“死区”。当信号衰减到这个死区内时，无法进一步衰减到0，而在几个量化电平之间跳动。
*   **对策**：增加字长，或使用级联结构。

#### **5.2 溢出振荡 (Overflow Oscillation)**
*   **成因**：这是最危险的振荡。在使用**补码**加法时，如果发生正溢出（比如最大正数+1），结果会变成最大负数。这种剧烈的突变相当于引入了巨大的阶跃信号，导致系统在大幅度范围内持续振荡。
*   **对策（必考）**：**饱和算术 (Saturation Arithmetic)**。
    *   即：如果计算结果溢出，不让它回绕（Wrap-around），而是强制让它等于最大值（或最小值）。
    *   虽然产生了非线性失真，但能抑制大幅度振荡。

---

## **三、 典型例题解析**

### **例题1：系数量化对稳定性的影响**
已知二阶IIR滤波器 $H(z) = \frac{1}{1 - 0.9z^{-1} + a_2 z^{-2}}$。
若理想系数 $a_2 = 0.95$。
1.  判断理想系统的稳定性。
2.  若系数 $a_2$ 被量化为 $1.0$（因精度不足），判断量化后系统的稳定性。

**解**：
1.  **理想情况**：稳定性条件是极点在单位圆内。对于二阶分母 $1 + a_1 z^{-1} + a_2 z^{-2}$，稳定性条件之一是 $|a_2| < 1$。
    这里 $a_2 = 0.95 < 1$，且判别式满足条件，故**稳定**。
2.  **量化后**：$a_2' = 1.0$。
    此时极点积 $p_1 p_2 = a_2' = 1$。说明至少有一个极点模为1（在单位圆上）。
    实际上，根据稳定性条件 $|a_2| < 1$，现在 $|a_2|=1$，系统处于**临界稳定或不稳定**边缘。
    *   这说明系数量化改变了系统的稳定性。

### **例题2：结构与误差**
为什么工程上实现高阶IIR滤波器时，通常采用二阶节级联结构，而不采用直接型结构？
**答**：
主要有两个原因（有限字长效应）：
1.  **稳定性**：直接型结构的极点位置对系数变化非常敏感。高阶时，微小的系数量化误差可能导致极点移出单位圆，使系统不稳定。而级联型将极点分组到各个二阶节中，独立控制，灵敏度低。
2.  **动态范围与噪声**：直接型结构的中间节点可能产生很大的数值，容易溢出；同时运算噪声在反馈环路中容易被放大。级联型可以优化配对和排序，最小化噪声和防止溢出。

---

## **四、 第12讲小结**

1.  **三大误差**：
    *   A/D噪声 $\to$ 限制了系统的底噪。
    *   系数量化 $\to$ 改变频响，甚至导致IIR不稳定。
    *   运算量化 $\to$ 产生内部噪声，IIR中会被放大。
2.  **IIR的特殊问题**：由于有反馈，IIR比FIR脆弱得多。
    *   必须警惕**稳定性丧失**。
    *   必须警惕**极限环振荡**。
3.  **工程对策**：
    *   结构上：使用**级联型**（二阶节）。
    *   运算上：使用**饱和算术**防止溢出振荡。
    *   硬件上：使用更多位宽（如32位浮点）。

---

## **全课程总结与复习建议**

恭喜你！至此，我们已经完成了《数字信号处理》全课程的系统复习。

### **1. 知识脉络回顾**
*   **Ch1 基础**：离散信号、LTI系统、卷积。
*   **Ch2 接口**：采样定理（不混叠的条件）。
*   **Ch3 算法**：DFT（频谱采样）与 FFT（快速算法）。
*   **Ch4/5 设计**：
    *   IIR：模拟原型 $\to$ 双线性变换 $\to$ 效率高，非线性相位。
    *   FIR：窗函数截断 $\to$ 线性相位，阶数高。
*   **Ch6 实现**：结构流图、量化误差、稳定性分析。

### **2. 复习建议**
1.  **抓大放小**：先搞懂物理概念（如：什么是混叠？什么是线性相位？为什么FFT快？），再死磕计算公式。
2.  **画图辅助**：复习时多画图（蝶形图、收敛域ROC、零极点分布图、频率响应图），图形比公式更直观。
3.  **计算重点**：
    *   圆周卷积与线性卷积的计算（补零）。
    *   基2-FFT的蝶形运算。
    *   双线性变换法的公式代入。
    *   窗函数法求 $h(n)$ 的表达式。

希望这份讲义能帮助你构建起完整的数字信号处理知识体系，祝学习顺利，考试高分！